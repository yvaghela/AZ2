{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "d328a9a6-ee2f-4924-8615-0e0330a38445",
   "metadata": {
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Collecting snowflake-snowpark-python\n",
      "  Using cached snowflake_snowpark_python-1.2.0-py3-none-any.whl (257 kB)\n",
      "Requirement already satisfied: wheel in /opt/conda/lib/python3.8/site-packages (from snowflake-snowpark-python) (0.38.4)\n",
      "Requirement already satisfied: setuptools>=40.6.0 in /opt/conda/lib/python3.8/site-packages (from snowflake-snowpark-python) (67.2.0)\n",
      "Collecting typing-extensions<5.0.0,>=4.1.0\n",
      "  Using cached typing_extensions-4.5.0-py3-none-any.whl (27 kB)\n",
      "Collecting snowflake-connector-python<4.0.0,>=2.7.12\n",
      "  Using cached snowflake_connector_python-3.0.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (24.6 MB)\n",
      "Requirement already satisfied: cloudpickle<=2.0.0,>=1.6.0 in /opt/conda/lib/python3.8/site-packages (from snowflake-snowpark-python) (2.0.0)\n",
      "Requirement already satisfied: pyOpenSSL<24.0.0,>=16.2.0 in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (23.0.0)\n",
      "Collecting filelock<4,>=3.5\n",
      "  Using cached filelock-3.9.0-py3-none-any.whl (9.7 kB)\n",
      "Requirement already satisfied: requests<3.0.0 in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (2.28.2)\n",
      "Requirement already satisfied: pytz in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (2021.3)\n",
      "Requirement already satisfied: certifi>=2017.4.17 in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (2022.12.7)\n",
      "Requirement already satisfied: cffi<2.0.0,>=1.9 in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (1.14.6)\n",
      "Requirement already satisfied: urllib3<1.27,>=1.21.1 in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (1.26.14)\n",
      "Requirement already satisfied: cryptography<41.0.0,>=3.1.0 in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (39.0.1)\n",
      "Requirement already satisfied: charset-normalizer<3,>=2 in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (2.0.4)\n",
      "Collecting oscrypto<2.0.0\n",
      "  Using cached oscrypto-1.3.0-py2.py3-none-any.whl (194 kB)\n",
      "Collecting pycryptodomex!=3.5.0,<4.0.0,>=3.2\n",
      "  Using cached pycryptodomex-3.17-cp35-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.1 MB)\n",
      "Requirement already satisfied: idna<4,>=2.5 in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (3.2)\n",
      "Collecting pyjwt<3.0.0\n",
      "  Using cached PyJWT-2.6.0-py3-none-any.whl (20 kB)\n",
      "Requirement already satisfied: asn1crypto<2.0.0,>0.24.0 in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (1.4.0)\n",
      "Requirement already satisfied: packaging in /opt/conda/lib/python3.8/site-packages (from snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (21.0)\n",
      "Requirement already satisfied: pycparser in /opt/conda/lib/python3.8/site-packages (from cffi<2.0.0,>=1.9->snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (2.20)\n",
      "Collecting asn1crypto<2.0.0,>0.24.0\n",
      "  Using cached asn1crypto-1.5.1-py2.py3-none-any.whl (105 kB)\n",
      "Requirement already satisfied: pyparsing>=2.0.2 in /opt/conda/lib/python3.8/site-packages (from packaging->snowflake-connector-python<4.0.0,>=2.7.12->snowflake-snowpark-python) (3.0.4)\n",
      "Installing collected packages: asn1crypto, typing-extensions, pyjwt, pycryptodomex, oscrypto, filelock, snowflake-connector-python, snowflake-snowpark-python\n",
      "  Attempting uninstall: asn1crypto\n",
      "    Found existing installation: asn1crypto 1.4.0\n",
      "    Uninstalling asn1crypto-1.4.0:\n",
      "      Successfully uninstalled asn1crypto-1.4.0\n",
      "  Attempting uninstall: typing-extensions\n",
      "    Found existing installation: typing-extensions 3.10.0.2\n",
      "    Uninstalling typing-extensions-3.10.0.2:\n",
      "      Successfully uninstalled typing-extensions-3.10.0.2\n",
      "  Attempting uninstall: filelock\n",
      "    Found existing installation: filelock 3.3.1\n",
      "    Uninstalling filelock-3.3.1:\n",
      "      Successfully uninstalled filelock-3.3.1\n",
      "Successfully installed asn1crypto-1.5.1 filelock-3.9.0 oscrypto-1.3.0 pycryptodomex-3.17 pyjwt-2.6.0 snowflake-connector-python-3.0.1 snowflake-snowpark-python-1.2.0 typing-extensions-4.5.0\n",
      "\u001b[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\u001b[0m\u001b[33m\n",
      "\u001b[0m\n",
      "\u001b[1m[\u001b[0m\u001b[34;49mnotice\u001b[0m\u001b[1;39;49m]\u001b[0m\u001b[39;49m A new release of pip is available: \u001b[0m\u001b[31;49m23.0\u001b[0m\u001b[39;49m -> \u001b[0m\u001b[32;49m23.0.1\u001b[0m\n",
      "\u001b[1m[\u001b[0m\u001b[34;49mnotice\u001b[0m\u001b[1;39;49m]\u001b[0m\u001b[39;49m To update, run: \u001b[0m\u001b[32;49mpip install --upgrade pip\u001b[0m\n",
      "Note: you may need to restart the kernel to use updated packages.\n"
     ]
    }
   ],
   "source": [
    "pip install snowflake-snowpark-python"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "5738508d-caa3-4d98-bb04-aac3737cbb3c",
   "metadata": {
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/opt/conda/lib/python3.8/site-packages/snowflake/connector/options.py:107: UserWarning: You have an incompatible version of 'pyarrow' installed (11.0.0), please install a version that adheres to: 'pyarrow<10.1.0,>=10.0.1; extra == \"pandas\"'\n",
      "  warn_incompatible_dep(\n"
     ]
    }
   ],
   "source": [
    "from snowflake.snowpark.functions import avg\n",
    "import pandas as pd\n",
    "from snowflake.snowpark import Session\n",
    "import snowflake.connector"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "9a227bf1-eecd-4f21-947f-2272d504c68c",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "connection_parameters = {\n",
    "    \"account\" :'hx98846.us-east-2.aws',\n",
    "    \"user\" : \"YVaghela\",\n",
    "    \"password\" : 'lo&FnnPr5Ur4NQwseK1I1E*L$jmV6W',\n",
    "    \"role\" : 'GRATICULE_PC',\n",
    "    \"warehouse\" : 'GRATICULE_WH_S',\n",
    "    \"database\" : 'DEID_PLATFORM',\n",
    "    \"schema\" : 'GRATICULESOW3A'\n",
    "}\n",
    "\n",
    "control_session = Session.builder.configs(connection_parameters).create()\n",
    "\n",
    "\n",
    "connection_parameters = {\n",
    "    \"account\" :'fk72744.us-east-2.aws',\n",
    "    \"user\" : \"yashrajsingh\",\n",
    "    \"password\" : 'Unlock2?',\n",
    "    \"role\" : 'ACCOUNTADMIN',\n",
    "    \"warehouse\" : 'COMPUTE_WH',\n",
    "    \"database\" : 'HRPCI',\n",
    "    \"schema\" : 'GRATICULESOW3'\n",
    "}\n",
    "\n",
    "case_session = Session.builder.configs(connection_parameters).create()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "5f83ede1-dc81-484b-abae-7be39f53317a",
   "metadata": {
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<snowflake.snowpark.session.Session at 0x7f3b5e01ff40>"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "case_session"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "8b21353e-ea4c-44d3-92d4-aeca9ae01ea4",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "control_age = control_session.sql(\"\"\"\n",
    "select distinct masterpatientid, 12 as age from ( \n",
    "       select masterpatientid,a_pat.patientid from (\n",
    "           select masterpatientid, patientid,dataownerid \n",
    "           from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS \n",
    "           where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "           '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "           '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "           '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "           '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "           '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "           'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  \n",
    "           and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =12 and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL \n",
    " select distinct masterpatientid, 13 as age from ( \n",
    "     select masterpatientid,a_pat.patientid from (\n",
    "         select masterpatientid, patientid,dataownerid \n",
    "         from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS \n",
    "         where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =13  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL \n",
    " select distinct masterpatientid, 14 as age from ( \n",
    "     select masterpatientid,a_pat.patientid from (\n",
    "         select masterpatientid, patientid,dataownerid \n",
    "         from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS \n",
    "         where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =14  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 15 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =15  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 16 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =16  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 17 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =17  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 18 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =18  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 19 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =19  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 20 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =20  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 21 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =21  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 22 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =22  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 23 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =23  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 24 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =24  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 25 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =25  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 26 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =26  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 27 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =27  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 28 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =28  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 29 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =29  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 30 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =30  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 31 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =31  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 32 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =32  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 33 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =33  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 34 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =34  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 35 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =35  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 36 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =36  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 37 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =37  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 38 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =38  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 39 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =39  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 40 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =40  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 41 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =41  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 42 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =42  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 43 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =43  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 44 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =44  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 45 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =45  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 46 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =46  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 47 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =47  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 48 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =48  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 49 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =49  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 50 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =50  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 51 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =51  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 52 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =52  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 53 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =53  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 54 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =54  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 55 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =55  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 56 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =56  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 57 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =57  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 58 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =58  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 59 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =59  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 60 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =60  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 61 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =61  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 62 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =62  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 63 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =63  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 64 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =64  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 65 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =65  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 66 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =66  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 67 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =67  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 68 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =68  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 69 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =69  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 70 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =70  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 71 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =71  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 72 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =72  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 73 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =73  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 74 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =74  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 75 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =75  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 76 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =76  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 77 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =77  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 78 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =78  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 79 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =79  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 80 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =80  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 81 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =81  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 82 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =82  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 83 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =83  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 84 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =84  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 85 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =85  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 86 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =86  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 87 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =87  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 88 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =88  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 89 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =89  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 90 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =90  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 91 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =91  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 92 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =92  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 93 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =93  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 94 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =94  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 95 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =95  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 96 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =96  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 97 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =97  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 98 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =98  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 99 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =99  and datarefreshid=1) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    " UNION ALL select distinct masterpatientid, 100 as age from ( select masterpatientid,a_pat.patientid from (select masterpatientid, patientid,dataownerid from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_PATIENTS where dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a','1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11','5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7','5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b','6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920','7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3','86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363','a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901','c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df','c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')  and DATEDIFF(year,BIRTHDATE,DATE('2022-02-24')) =100 and datarefreshid=1 ) a_pat INNER JOIN (select patientid, encounterdate             from DEID_PLATFORM.GRATICULESOW3A.VW_DEID_ENCOUNTERS                           ) en             on a_pat.patientid = en.patientid             where (encounterdate >= ((DATE('2022-02-24'))-365) AND encounterdate < DATE('2022-02-24') AND encounterdate is not null) )\n",
    "\"\"\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "f48914d0-14e7-4705-81a6-9d1abfdb9c18",
   "metadata": {
    "tags": []
   },
   "outputs": [
    {
     "ename": "KeyboardInterrupt",
     "evalue": "",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)",
      "Cell \u001b[0;32mIn[7], line 1\u001b[0m\n\u001b[0;32m----> 1\u001b[0m \u001b[43mcontrol_age\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mcount\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/snowpark/dataframe.py:2468\u001b[0m, in \u001b[0;36mDataFrame.count\u001b[0;34m(self, statement_params, block)\u001b[0m\n\u001b[1;32m   2466\u001b[0m df \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39magg((\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m*\u001b[39m\u001b[38;5;124m\"\u001b[39m, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mcount\u001b[39m\u001b[38;5;124m\"\u001b[39m))\n\u001b[1;32m   2467\u001b[0m add_api_call(df, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mDataFrame.count\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[0;32m-> 2468\u001b[0m result \u001b[38;5;241m=\u001b[39m \u001b[43mdf\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_internal_collect_with_tag\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m   2469\u001b[0m \u001b[43m    \u001b[49m\u001b[43mstatement_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mstatement_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   2470\u001b[0m \u001b[43m    \u001b[49m\u001b[43mblock\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mblock\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   2471\u001b[0m \u001b[43m    \u001b[49m\u001b[43mdata_type\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_AsyncResultType\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mCOUNT\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   2472\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m   2473\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m result[\u001b[38;5;241m0\u001b[39m][\u001b[38;5;241m0\u001b[39m] \u001b[38;5;28;01mif\u001b[39;00m block \u001b[38;5;28;01melse\u001b[39;00m result\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/snowpark/_internal/telemetry.py:138\u001b[0m, in \u001b[0;36mdf_collect_api_telemetry.<locals>.wrap\u001b[0;34m(*args, **kwargs)\u001b[0m\n\u001b[1;32m    135\u001b[0m \u001b[38;5;129m@functools\u001b[39m\u001b[38;5;241m.\u001b[39mwraps(func)\n\u001b[1;32m    136\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mwrap\u001b[39m(\u001b[38;5;241m*\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs):\n\u001b[1;32m    137\u001b[0m     \u001b[38;5;28;01mwith\u001b[39;00m args[\u001b[38;5;241m0\u001b[39m]\u001b[38;5;241m.\u001b[39m_session\u001b[38;5;241m.\u001b[39mquery_history() \u001b[38;5;28;01mas\u001b[39;00m query_history:\n\u001b[0;32m--> 138\u001b[0m         result \u001b[38;5;241m=\u001b[39m \u001b[43mfunc\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    139\u001b[0m     plan \u001b[38;5;241m=\u001b[39m args[\u001b[38;5;241m0\u001b[39m]\u001b[38;5;241m.\u001b[39m_select_statement \u001b[38;5;129;01mor\u001b[39;00m args[\u001b[38;5;241m0\u001b[39m]\u001b[38;5;241m.\u001b[39m_plan\n\u001b[1;32m    140\u001b[0m     api_calls \u001b[38;5;241m=\u001b[39m [\n\u001b[1;32m    141\u001b[0m         \u001b[38;5;241m*\u001b[39mplan\u001b[38;5;241m.\u001b[39mapi_calls,\n\u001b[1;32m    142\u001b[0m         {TelemetryField\u001b[38;5;241m.\u001b[39mNAME\u001b[38;5;241m.\u001b[39mvalue: \u001b[38;5;124mf\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mDataFrame.\u001b[39m\u001b[38;5;132;01m{\u001b[39;00mfunc\u001b[38;5;241m.\u001b[39m\u001b[38;5;18m__name__\u001b[39m\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m\"\u001b[39m},\n\u001b[1;32m    143\u001b[0m     ]\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/snowpark/dataframe.py:581\u001b[0m, in \u001b[0;36mDataFrame._internal_collect_with_tag_no_telemetry\u001b[0;34m(self, statement_params, block, data_type)\u001b[0m\n\u001b[1;32m    571\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21m_internal_collect_with_tag_no_telemetry\u001b[39m(\n\u001b[1;32m    572\u001b[0m     \u001b[38;5;28mself\u001b[39m,\n\u001b[1;32m    573\u001b[0m     \u001b[38;5;241m*\u001b[39m,\n\u001b[0;32m   (...)\u001b[0m\n\u001b[1;32m    579\u001b[0m     \u001b[38;5;66;03m# we should always call this method instead of collect(), to make sure the\u001b[39;00m\n\u001b[1;32m    580\u001b[0m     \u001b[38;5;66;03m# query tag is set properly.\u001b[39;00m\n\u001b[0;32m--> 581\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_session\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_conn\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mexecute\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    582\u001b[0m \u001b[43m        \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_plan\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    583\u001b[0m \u001b[43m        \u001b[49m\u001b[43mblock\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mblock\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    584\u001b[0m \u001b[43m        \u001b[49m\u001b[43mdata_type\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mdata_type\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    585\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_statement_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mcreate_or_update_statement_params_with_query_tag\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    586\u001b[0m \u001b[43m            \u001b[49m\u001b[43mstatement_params\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_session\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mquery_tag\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mSKIP_LEVELS_THREE\u001b[49m\n\u001b[1;32m    587\u001b[0m \u001b[43m        \u001b[49m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    588\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/snowpark/_internal/server_connection.py:410\u001b[0m, in \u001b[0;36mServerConnection.execute\u001b[0;34m(self, plan, to_pandas, to_iter, block, data_type, **kwargs)\u001b[0m\n\u001b[1;32m    406\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m is_in_stored_procedure() \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m block:  \u001b[38;5;66;03m# pragma: no cover\u001b[39;00m\n\u001b[1;32m    407\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mNotImplementedError\u001b[39;00m(\n\u001b[1;32m    408\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mAsync query is not supported in stored procedure yet\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m    409\u001b[0m     )\n\u001b[0;32m--> 410\u001b[0m result_set, result_meta \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mget_result_set\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    411\u001b[0m \u001b[43m    \u001b[49m\u001b[43mplan\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mto_pandas\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mto_iter\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mblock\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mblock\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mdata_type\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mdata_type\u001b[49m\n\u001b[1;32m    412\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    413\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m block:\n\u001b[1;32m    414\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m result_set\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/snowpark/_internal/analyzer/snowflake_plan.py:89\u001b[0m, in \u001b[0;36mSnowflakePlan.Decorator.wrap_exception.<locals>.wrap\u001b[0;34m(*args, **kwargs)\u001b[0m\n\u001b[1;32m     87\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mwrap\u001b[39m(\u001b[38;5;241m*\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs):\n\u001b[1;32m     88\u001b[0m     \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[0;32m---> 89\u001b[0m         \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mfunc\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m     90\u001b[0m     \u001b[38;5;28;01mexcept\u001b[39;00m snowflake\u001b[38;5;241m.\u001b[39mconnector\u001b[38;5;241m.\u001b[39merrors\u001b[38;5;241m.\u001b[39mProgrammingError \u001b[38;5;28;01mas\u001b[39;00m e:\n\u001b[1;32m     91\u001b[0m         tb \u001b[38;5;241m=\u001b[39m sys\u001b[38;5;241m.\u001b[39mexc_info()[\u001b[38;5;241m2\u001b[39m]\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/snowpark/_internal/server_connection.py:498\u001b[0m, in \u001b[0;36mServerConnection.get_result_set\u001b[0;34m(self, plan, to_pandas, to_iter, block, data_type, **kwargs)\u001b[0m\n\u001b[1;32m    496\u001b[0m \u001b[38;5;28;01mfor\u001b[39;00m holder, id_ \u001b[38;5;129;01min\u001b[39;00m placeholders\u001b[38;5;241m.\u001b[39mitems():\n\u001b[1;32m    497\u001b[0m     final_query \u001b[38;5;241m=\u001b[39m final_query\u001b[38;5;241m.\u001b[39mreplace(holder, id_)\n\u001b[0;32m--> 498\u001b[0m result \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mrun_query\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    499\u001b[0m \u001b[43m    \u001b[49m\u001b[43mfinal_query\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    500\u001b[0m \u001b[43m    \u001b[49m\u001b[43mto_pandas\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    501\u001b[0m \u001b[43m    \u001b[49m\u001b[43mto_iter\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;129;43;01mand\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[43m(\u001b[49m\u001b[43mi\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m==\u001b[39;49m\u001b[43m \u001b[49m\u001b[38;5;28;43mlen\u001b[39;49m\u001b[43m(\u001b[49m\u001b[43mplan\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mqueries\u001b[49m\u001b[43m)\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m-\u001b[39;49m\u001b[43m \u001b[49m\u001b[38;5;241;43m1\u001b[39;49m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    502\u001b[0m \u001b[43m    \u001b[49m\u001b[43mis_ddl_on_temp_object\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mquery\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mis_ddl_on_temp_object\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    503\u001b[0m \u001b[43m    \u001b[49m\u001b[43mblock\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;129;43;01mnot\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[43mis_last\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    504\u001b[0m \u001b[43m    \u001b[49m\u001b[43mdata_type\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mdata_type\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    505\u001b[0m \u001b[43m    \u001b[49m\u001b[43masync_job_plan\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mplan\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    506\u001b[0m \u001b[43m    \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    507\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    508\u001b[0m placeholders[query\u001b[38;5;241m.\u001b[39mquery_id_place_holder] \u001b[38;5;241m=\u001b[39m (\n\u001b[1;32m    509\u001b[0m     result[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124msfqid\u001b[39m\u001b[38;5;124m\"\u001b[39m] \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m is_last \u001b[38;5;28;01melse\u001b[39;00m result\u001b[38;5;241m.\u001b[39mquery_id\n\u001b[1;32m    510\u001b[0m )\n\u001b[1;32m    511\u001b[0m result_meta \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_cursor\u001b[38;5;241m.\u001b[39mdescription\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/snowpark/_internal/server_connection.py:94\u001b[0m, in \u001b[0;36mServerConnection._Decorator.wrap_exception.<locals>.wrap\u001b[0;34m(*args, **kwargs)\u001b[0m\n\u001b[1;32m     92\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m SnowparkClientExceptionMessages\u001b[38;5;241m.\u001b[39mSERVER_SESSION_HAS_BEEN_CLOSED()\n\u001b[1;32m     93\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[0;32m---> 94\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mfunc\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m     95\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m ReauthenticationRequest \u001b[38;5;28;01mas\u001b[39;00m ex:\n\u001b[1;32m     96\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m SnowparkClientExceptionMessages\u001b[38;5;241m.\u001b[39mSERVER_SESSION_EXPIRED(\n\u001b[1;32m     97\u001b[0m         ex\u001b[38;5;241m.\u001b[39mcause\n\u001b[1;32m     98\u001b[0m     )\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/snowpark/_internal/server_connection.py:321\u001b[0m, in \u001b[0;36mServerConnection.run_query\u001b[0;34m(self, query, to_pandas, to_iter, is_ddl_on_temp_object, block, data_type, async_job_plan, **kwargs)\u001b[0m\n\u001b[1;32m    319\u001b[0m     kwargs[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m_statement_params\u001b[39m\u001b[38;5;124m\"\u001b[39m][\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mSNOWPARK_SKIP_TXN_COMMIT_IN_DDL\u001b[39m\u001b[38;5;124m\"\u001b[39m] \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;01mTrue\u001b[39;00m\n\u001b[1;32m    320\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m block:\n\u001b[0;32m--> 321\u001b[0m     results_cursor \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_cursor\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mexecute\u001b[49m\u001b[43m(\u001b[49m\u001b[43mquery\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    322\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mnotify_query_listeners(\n\u001b[1;32m    323\u001b[0m         QueryRecord(results_cursor\u001b[38;5;241m.\u001b[39msfqid, results_cursor\u001b[38;5;241m.\u001b[39mquery)\n\u001b[1;32m    324\u001b[0m     )\n\u001b[1;32m    325\u001b[0m     logger\u001b[38;5;241m.\u001b[39mdebug(\u001b[38;5;124mf\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mExecute query [queryID: \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mresults_cursor\u001b[38;5;241m.\u001b[39msfqid\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m] \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mquery\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m\"\u001b[39m)\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/cursor.py:739\u001b[0m, in \u001b[0;36mSnowflakeCursor.execute\u001b[0;34m(self, command, params, _bind_stage, timeout, _exec_async, _no_retry, _do_reset, _put_callback, _put_azure_callback, _put_callback_output_stream, _get_callback, _get_azure_callback, _get_callback_output_stream, _show_progress_bar, _statement_params, _is_internal, _describe_only, _no_results, _is_put_get, _raise_put_get_error, _force_put_overwrite, file_stream, num_statements)\u001b[0m\n\u001b[1;32m    737\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m logger\u001b[38;5;241m.\u001b[39mgetEffectiveLevel() \u001b[38;5;241m<\u001b[39m\u001b[38;5;241m=\u001b[39m logging\u001b[38;5;241m.\u001b[39mINFO:\n\u001b[1;32m    738\u001b[0m     logger\u001b[38;5;241m.\u001b[39minfo(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mquery: [\u001b[39m\u001b[38;5;132;01m%s\u001b[39;00m\u001b[38;5;124m]\u001b[39m\u001b[38;5;124m\"\u001b[39m, \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_format_query_for_log(query))\n\u001b[0;32m--> 739\u001b[0m ret \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_execute_helper\u001b[49m\u001b[43m(\u001b[49m\u001b[43mquery\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    740\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_sfqid \u001b[38;5;241m=\u001b[39m (\n\u001b[1;32m    741\u001b[0m     ret[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mdata\u001b[39m\u001b[38;5;124m\"\u001b[39m][\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mqueryId\u001b[39m\u001b[38;5;124m\"\u001b[39m]\n\u001b[1;32m    742\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mdata\u001b[39m\u001b[38;5;124m\"\u001b[39m \u001b[38;5;129;01min\u001b[39;00m ret \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mqueryId\u001b[39m\u001b[38;5;124m\"\u001b[39m \u001b[38;5;129;01min\u001b[39;00m ret[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mdata\u001b[39m\u001b[38;5;124m\"\u001b[39m]\n\u001b[1;32m    743\u001b[0m     \u001b[38;5;28;01melse\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m\n\u001b[1;32m    744\u001b[0m )\n\u001b[1;32m    745\u001b[0m logger\u001b[38;5;241m.\u001b[39mdebug(\u001b[38;5;124mf\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124msfqid: \u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39msfqid\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m\"\u001b[39m)\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/cursor.py:522\u001b[0m, in \u001b[0;36mSnowflakeCursor._execute_helper\u001b[0;34m(self, query, timeout, statement_params, binding_params, binding_stage, is_internal, describe_only, _no_results, _is_put_get, _no_retry)\u001b[0m\n\u001b[1;32m    520\u001b[0m ret: \u001b[38;5;28mdict\u001b[39m[\u001b[38;5;28mstr\u001b[39m, Any] \u001b[38;5;241m=\u001b[39m {\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mdata\u001b[39m\u001b[38;5;124m\"\u001b[39m: {}}\n\u001b[1;32m    521\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[0;32m--> 522\u001b[0m     ret \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_connection\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mcmd_query\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    523\u001b[0m \u001b[43m        \u001b[49m\u001b[43mquery\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    524\u001b[0m \u001b[43m        \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_sequence_counter\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    525\u001b[0m \u001b[43m        \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_request_id\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    526\u001b[0m \u001b[43m        \u001b[49m\u001b[43mbinding_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mbinding_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    527\u001b[0m \u001b[43m        \u001b[49m\u001b[43mbinding_stage\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mbinding_stage\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    528\u001b[0m \u001b[43m        \u001b[49m\u001b[43mis_file_transfer\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43mbool\u001b[39;49m\u001b[43m(\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_is_file_transfer\u001b[49m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    529\u001b[0m \u001b[43m        \u001b[49m\u001b[43mstatement_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mstatement_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    530\u001b[0m \u001b[43m        \u001b[49m\u001b[43mis_internal\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mis_internal\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    531\u001b[0m \u001b[43m        \u001b[49m\u001b[43mdescribe_only\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mdescribe_only\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    532\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_no_results\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_no_results\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    533\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_no_retry\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_no_retry\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    534\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    535\u001b[0m \u001b[38;5;28;01mfinally\u001b[39;00m:\n\u001b[1;32m    536\u001b[0m     \u001b[38;5;28;01mtry\u001b[39;00m:\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/connection.py:1067\u001b[0m, in \u001b[0;36mSnowflakeConnection.cmd_query\u001b[0;34m(self, sql, sequence_counter, request_id, binding_params, binding_stage, is_file_transfer, statement_params, is_internal, describe_only, _no_results, _update_current_object, _no_retry)\u001b[0m\n\u001b[1;32m   1058\u001b[0m     logger\u001b[38;5;241m.\u001b[39mdebug(\n\u001b[1;32m   1059\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124msql=[\u001b[39m\u001b[38;5;132;01m%s\u001b[39;00m\u001b[38;5;124m], sequence_id=[\u001b[39m\u001b[38;5;132;01m%s\u001b[39;00m\u001b[38;5;124m], is_file_transfer=[\u001b[39m\u001b[38;5;132;01m%s\u001b[39;00m\u001b[38;5;124m]\u001b[39m\u001b[38;5;124m\"\u001b[39m,\n\u001b[1;32m   1060\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_format_query_for_log(data[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124msqlText\u001b[39m\u001b[38;5;124m\"\u001b[39m]),\n\u001b[1;32m   1061\u001b[0m         data[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124msequenceId\u001b[39m\u001b[38;5;124m\"\u001b[39m],\n\u001b[1;32m   1062\u001b[0m         is_file_transfer,\n\u001b[1;32m   1063\u001b[0m     )\n\u001b[1;32m   1065\u001b[0m url_parameters \u001b[38;5;241m=\u001b[39m {REQUEST_ID: request_id}\n\u001b[0;32m-> 1067\u001b[0m ret \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mrest\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mrequest\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m   1068\u001b[0m \u001b[43m    \u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43m/queries/v1/query-request?\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m \u001b[49m\u001b[38;5;241;43m+\u001b[39;49m\u001b[43m \u001b[49m\u001b[43murlencode\u001b[49m\u001b[43m(\u001b[49m\u001b[43murl_parameters\u001b[49m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1069\u001b[0m \u001b[43m    \u001b[49m\u001b[43mdata\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1070\u001b[0m \u001b[43m    \u001b[49m\u001b[43mclient\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mclient\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1071\u001b[0m \u001b[43m    \u001b[49m\u001b[43m_no_results\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_no_results\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1072\u001b[0m \u001b[43m    \u001b[49m\u001b[43m_include_retry_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[1;32m   1073\u001b[0m \u001b[43m    \u001b[49m\u001b[43m_no_retry\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_no_retry\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1074\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m   1076\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m ret \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[1;32m   1077\u001b[0m     ret \u001b[38;5;241m=\u001b[39m {\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mdata\u001b[39m\u001b[38;5;124m\"\u001b[39m: {}}\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/network.py:476\u001b[0m, in \u001b[0;36mSnowflakeRestful.request\u001b[0;34m(self, url, body, method, client, _no_results, timeout, _include_retry_params, _no_retry)\u001b[0m\n\u001b[1;32m    474\u001b[0m     headers[HTTP_HEADER_SERVICE_NAME] \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_connection\u001b[38;5;241m.\u001b[39mservice_name\n\u001b[1;32m    475\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m method \u001b[38;5;241m==\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mpost\u001b[39m\u001b[38;5;124m\"\u001b[39m:\n\u001b[0;32m--> 476\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_post_request\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    477\u001b[0m \u001b[43m        \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    478\u001b[0m \u001b[43m        \u001b[49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    479\u001b[0m \u001b[43m        \u001b[49m\u001b[43mjson\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mdumps\u001b[49m\u001b[43m(\u001b[49m\u001b[43mbody\u001b[49m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    480\u001b[0m \u001b[43m        \u001b[49m\u001b[43mtoken\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mtoken\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    481\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_no_results\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_no_results\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    482\u001b[0m \u001b[43m        \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mtimeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    483\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_include_retry_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_include_retry_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    484\u001b[0m \u001b[43m        \u001b[49m\u001b[43mno_retry\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_no_retry\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    485\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    486\u001b[0m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[1;32m    487\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_get_request(url, headers, token\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mtoken, timeout\u001b[38;5;241m=\u001b[39mtimeout)\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/network.py:715\u001b[0m, in \u001b[0;36mSnowflakeRestful._post_request\u001b[0;34m(self, url, headers, body, token, timeout, _no_results, no_retry, socket_timeout, _include_retry_params)\u001b[0m\n\u001b[1;32m    712\u001b[0m     ret \u001b[38;5;241m=\u001b[39m probe_connection(full_url)\n\u001b[1;32m    713\u001b[0m     pprint(ret)\n\u001b[0;32m--> 715\u001b[0m ret \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mfetch\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    716\u001b[0m \u001b[43m    \u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mpost\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[1;32m    717\u001b[0m \u001b[43m    \u001b[49m\u001b[43mfull_url\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    718\u001b[0m \u001b[43m    \u001b[49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    719\u001b[0m \u001b[43m    \u001b[49m\u001b[43mdata\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mbody\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    720\u001b[0m \u001b[43m    \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mtimeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    721\u001b[0m \u001b[43m    \u001b[49m\u001b[43mtoken\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mtoken\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    722\u001b[0m \u001b[43m    \u001b[49m\u001b[43mno_retry\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mno_retry\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    723\u001b[0m \u001b[43m    \u001b[49m\u001b[43msocket_timeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43msocket_timeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    724\u001b[0m \u001b[43m    \u001b[49m\u001b[43m_include_retry_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_include_retry_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    725\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    726\u001b[0m logger\u001b[38;5;241m.\u001b[39mdebug(\n\u001b[1;32m    727\u001b[0m     \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mret[code] = \u001b[39m\u001b[38;5;132;01m{code}\u001b[39;00m\u001b[38;5;124m, after post request\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;241m.\u001b[39mformat(\n\u001b[1;32m    728\u001b[0m         code\u001b[38;5;241m=\u001b[39m(ret\u001b[38;5;241m.\u001b[39mget(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mcode\u001b[39m\u001b[38;5;124m\"\u001b[39m, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mN/A\u001b[39m\u001b[38;5;124m\"\u001b[39m))\n\u001b[1;32m    729\u001b[0m     )\n\u001b[1;32m    730\u001b[0m )\n\u001b[1;32m    732\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m ret\u001b[38;5;241m.\u001b[39mget(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mcode\u001b[39m\u001b[38;5;124m\"\u001b[39m) \u001b[38;5;241m==\u001b[39m SESSION_EXPIRED_GS_CODE:\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/network.py:813\u001b[0m, in \u001b[0;36mSnowflakeRestful.fetch\u001b[0;34m(self, method, full_url, headers, data, timeout, **kwargs)\u001b[0m\n\u001b[1;32m    811\u001b[0m retry_ctx \u001b[38;5;241m=\u001b[39m RetryCtx(timeout, include_retry_params)\n\u001b[1;32m    812\u001b[0m \u001b[38;5;28;01mwhile\u001b[39;00m \u001b[38;5;28;01mTrue\u001b[39;00m:\n\u001b[0;32m--> 813\u001b[0m     ret \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_request_exec_wrapper\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    814\u001b[0m \u001b[43m        \u001b[49m\u001b[43msession\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mfull_url\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mdata\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mretry_ctx\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\n\u001b[1;32m    815\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    816\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m ret \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[1;32m    817\u001b[0m         \u001b[38;5;28;01mreturn\u001b[39;00m ret\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/network.py:856\u001b[0m, in \u001b[0;36mSnowflakeRestful._request_exec_wrapper\u001b[0;34m(self, session, method, full_url, headers, data, retry_ctx, no_retry, token, **kwargs)\u001b[0m\n\u001b[1;32m    854\u001b[0m full_url \u001b[38;5;241m=\u001b[39m SnowflakeRestful\u001b[38;5;241m.\u001b[39madd_request_guid(full_url)\n\u001b[1;32m    855\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[0;32m--> 856\u001b[0m     return_object \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_request_exec\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    857\u001b[0m \u001b[43m        \u001b[49m\u001b[43msession\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43msession\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    858\u001b[0m \u001b[43m        \u001b[49m\u001b[43mmethod\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    859\u001b[0m \u001b[43m        \u001b[49m\u001b[43mfull_url\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mfull_url\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    860\u001b[0m \u001b[43m        \u001b[49m\u001b[43mheaders\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    861\u001b[0m \u001b[43m        \u001b[49m\u001b[43mdata\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mdata\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    862\u001b[0m \u001b[43m        \u001b[49m\u001b[43mtoken\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mtoken\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    863\u001b[0m \u001b[43m        \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    864\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    865\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m return_object \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[1;32m    866\u001b[0m         \u001b[38;5;28;01mreturn\u001b[39;00m return_object\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/network.py:1037\u001b[0m, in \u001b[0;36mSnowflakeRestful._request_exec\u001b[0;34m(self, session, method, full_url, headers, data, token, catch_okta_unauthorized_error, is_raw_text, is_raw_binary, binary_data_handler, socket_timeout)\u001b[0m\n\u001b[1;32m   1033\u001b[0m download_start_time \u001b[38;5;241m=\u001b[39m get_time_millis()\n\u001b[1;32m   1034\u001b[0m \u001b[38;5;66;03m# socket timeout is constant. You should be able to receive\u001b[39;00m\n\u001b[1;32m   1035\u001b[0m \u001b[38;5;66;03m# the response within the time. If not, ConnectReadTimeout or\u001b[39;00m\n\u001b[1;32m   1036\u001b[0m \u001b[38;5;66;03m# ReadTimeout is raised.\u001b[39;00m\n\u001b[0;32m-> 1037\u001b[0m raw_ret \u001b[38;5;241m=\u001b[39m \u001b[43msession\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mrequest\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m   1038\u001b[0m \u001b[43m    \u001b[49m\u001b[43mmethod\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1039\u001b[0m \u001b[43m    \u001b[49m\u001b[43murl\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mfull_url\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1040\u001b[0m \u001b[43m    \u001b[49m\u001b[43mheaders\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1041\u001b[0m \u001b[43m    \u001b[49m\u001b[43mdata\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43minput_data\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1042\u001b[0m \u001b[43m    \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43msocket_timeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1043\u001b[0m \u001b[43m    \u001b[49m\u001b[43mverify\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[1;32m   1044\u001b[0m \u001b[43m    \u001b[49m\u001b[43mstream\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mis_raw_binary\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1045\u001b[0m \u001b[43m    \u001b[49m\u001b[43mauth\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mSnowflakeAuth\u001b[49m\u001b[43m(\u001b[49m\u001b[43mtoken\u001b[49m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1046\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m   1047\u001b[0m download_end_time \u001b[38;5;241m=\u001b[39m get_time_millis()\n\u001b[1;32m   1049\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/requests/sessions.py:587\u001b[0m, in \u001b[0;36mSession.request\u001b[0;34m(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)\u001b[0m\n\u001b[1;32m    582\u001b[0m send_kwargs \u001b[38;5;241m=\u001b[39m {\n\u001b[1;32m    583\u001b[0m     \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mtimeout\u001b[39m\u001b[38;5;124m\"\u001b[39m: timeout,\n\u001b[1;32m    584\u001b[0m     \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mallow_redirects\u001b[39m\u001b[38;5;124m\"\u001b[39m: allow_redirects,\n\u001b[1;32m    585\u001b[0m }\n\u001b[1;32m    586\u001b[0m send_kwargs\u001b[38;5;241m.\u001b[39mupdate(settings)\n\u001b[0;32m--> 587\u001b[0m resp \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msend\u001b[49m\u001b[43m(\u001b[49m\u001b[43mprep\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43msend_kwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    589\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m resp\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/requests/sessions.py:701\u001b[0m, in \u001b[0;36mSession.send\u001b[0;34m(self, request, **kwargs)\u001b[0m\n\u001b[1;32m    698\u001b[0m start \u001b[38;5;241m=\u001b[39m preferred_clock()\n\u001b[1;32m    700\u001b[0m \u001b[38;5;66;03m# Send the request\u001b[39;00m\n\u001b[0;32m--> 701\u001b[0m r \u001b[38;5;241m=\u001b[39m \u001b[43madapter\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msend\u001b[49m\u001b[43m(\u001b[49m\u001b[43mrequest\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    703\u001b[0m \u001b[38;5;66;03m# Total elapsed time of the request (approximately)\u001b[39;00m\n\u001b[1;32m    704\u001b[0m elapsed \u001b[38;5;241m=\u001b[39m preferred_clock() \u001b[38;5;241m-\u001b[39m start\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/requests/adapters.py:489\u001b[0m, in \u001b[0;36mHTTPAdapter.send\u001b[0;34m(self, request, stream, timeout, verify, cert, proxies)\u001b[0m\n\u001b[1;32m    487\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[1;32m    488\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m chunked:\n\u001b[0;32m--> 489\u001b[0m         resp \u001b[38;5;241m=\u001b[39m \u001b[43mconn\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43murlopen\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    490\u001b[0m \u001b[43m            \u001b[49m\u001b[43mmethod\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mrequest\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    491\u001b[0m \u001b[43m            \u001b[49m\u001b[43murl\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    492\u001b[0m \u001b[43m            \u001b[49m\u001b[43mbody\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mrequest\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mbody\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    493\u001b[0m \u001b[43m            \u001b[49m\u001b[43mheaders\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mrequest\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    494\u001b[0m \u001b[43m            \u001b[49m\u001b[43mredirect\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[1;32m    495\u001b[0m \u001b[43m            \u001b[49m\u001b[43massert_same_host\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[1;32m    496\u001b[0m \u001b[43m            \u001b[49m\u001b[43mpreload_content\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[1;32m    497\u001b[0m \u001b[43m            \u001b[49m\u001b[43mdecode_content\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[1;32m    498\u001b[0m \u001b[43m            \u001b[49m\u001b[43mretries\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mmax_retries\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    499\u001b[0m \u001b[43m            \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mtimeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    500\u001b[0m \u001b[43m        \u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    502\u001b[0m     \u001b[38;5;66;03m# Send the request.\u001b[39;00m\n\u001b[1;32m    503\u001b[0m     \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[1;32m    504\u001b[0m         \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mhasattr\u001b[39m(conn, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mproxy_pool\u001b[39m\u001b[38;5;124m\"\u001b[39m):\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/urllib3/connectionpool.py:703\u001b[0m, in \u001b[0;36mHTTPConnectionPool.urlopen\u001b[0;34m(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, **response_kw)\u001b[0m\n\u001b[1;32m    700\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_prepare_proxy(conn)\n\u001b[1;32m    702\u001b[0m \u001b[38;5;66;03m# Make the request on the httplib connection object.\u001b[39;00m\n\u001b[0;32m--> 703\u001b[0m httplib_response \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_make_request\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    704\u001b[0m \u001b[43m    \u001b[49m\u001b[43mconn\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    705\u001b[0m \u001b[43m    \u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    706\u001b[0m \u001b[43m    \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    707\u001b[0m \u001b[43m    \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mtimeout_obj\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    708\u001b[0m \u001b[43m    \u001b[49m\u001b[43mbody\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mbody\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    709\u001b[0m \u001b[43m    \u001b[49m\u001b[43mheaders\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    710\u001b[0m \u001b[43m    \u001b[49m\u001b[43mchunked\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mchunked\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m    711\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    713\u001b[0m \u001b[38;5;66;03m# If we're going to release the connection in ``finally:``, then\u001b[39;00m\n\u001b[1;32m    714\u001b[0m \u001b[38;5;66;03m# the response doesn't need to know about the connection. Otherwise\u001b[39;00m\n\u001b[1;32m    715\u001b[0m \u001b[38;5;66;03m# it will also try to release it and we'll have a double-release\u001b[39;00m\n\u001b[1;32m    716\u001b[0m \u001b[38;5;66;03m# mess.\u001b[39;00m\n\u001b[1;32m    717\u001b[0m response_conn \u001b[38;5;241m=\u001b[39m conn \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m release_conn \u001b[38;5;28;01melse\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/urllib3/connectionpool.py:449\u001b[0m, in \u001b[0;36mHTTPConnectionPool._make_request\u001b[0;34m(self, conn, method, url, timeout, chunked, **httplib_request_kw)\u001b[0m\n\u001b[1;32m    444\u001b[0m             httplib_response \u001b[38;5;241m=\u001b[39m conn\u001b[38;5;241m.\u001b[39mgetresponse()\n\u001b[1;32m    445\u001b[0m         \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mBaseException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m e:\n\u001b[1;32m    446\u001b[0m             \u001b[38;5;66;03m# Remove the TypeError from the exception chain in\u001b[39;00m\n\u001b[1;32m    447\u001b[0m             \u001b[38;5;66;03m# Python 3 (including for exceptions like SystemExit).\u001b[39;00m\n\u001b[1;32m    448\u001b[0m             \u001b[38;5;66;03m# Otherwise it looks like a bug in the code.\u001b[39;00m\n\u001b[0;32m--> 449\u001b[0m             \u001b[43msix\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mraise_from\u001b[49m\u001b[43m(\u001b[49m\u001b[43me\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43;01mNone\u001b[39;49;00m\u001b[43m)\u001b[49m\n\u001b[1;32m    450\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m (SocketTimeout, BaseSSLError, SocketError) \u001b[38;5;28;01mas\u001b[39;00m e:\n\u001b[1;32m    451\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_raise_timeout(err\u001b[38;5;241m=\u001b[39me, url\u001b[38;5;241m=\u001b[39murl, timeout_value\u001b[38;5;241m=\u001b[39mread_timeout)\n",
      "File \u001b[0;32m<string>:3\u001b[0m, in \u001b[0;36mraise_from\u001b[0;34m(value, from_value)\u001b[0m\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/urllib3/connectionpool.py:444\u001b[0m, in \u001b[0;36mHTTPConnectionPool._make_request\u001b[0;34m(self, conn, method, url, timeout, chunked, **httplib_request_kw)\u001b[0m\n\u001b[1;32m    441\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mTypeError\u001b[39;00m:\n\u001b[1;32m    442\u001b[0m     \u001b[38;5;66;03m# Python 3\u001b[39;00m\n\u001b[1;32m    443\u001b[0m     \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[0;32m--> 444\u001b[0m         httplib_response \u001b[38;5;241m=\u001b[39m \u001b[43mconn\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mgetresponse\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    445\u001b[0m     \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mBaseException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m e:\n\u001b[1;32m    446\u001b[0m         \u001b[38;5;66;03m# Remove the TypeError from the exception chain in\u001b[39;00m\n\u001b[1;32m    447\u001b[0m         \u001b[38;5;66;03m# Python 3 (including for exceptions like SystemExit).\u001b[39;00m\n\u001b[1;32m    448\u001b[0m         \u001b[38;5;66;03m# Otherwise it looks like a bug in the code.\u001b[39;00m\n\u001b[1;32m    449\u001b[0m         six\u001b[38;5;241m.\u001b[39mraise_from(e, \u001b[38;5;28;01mNone\u001b[39;00m)\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/http/client.py:1348\u001b[0m, in \u001b[0;36mHTTPConnection.getresponse\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m   1346\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[1;32m   1347\u001b[0m     \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[0;32m-> 1348\u001b[0m         \u001b[43mresponse\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mbegin\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m   1349\u001b[0m     \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mConnectionError\u001b[39;00m:\n\u001b[1;32m   1350\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mclose()\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/http/client.py:316\u001b[0m, in \u001b[0;36mHTTPResponse.begin\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    314\u001b[0m \u001b[38;5;66;03m# read until we get a non-100 response\u001b[39;00m\n\u001b[1;32m    315\u001b[0m \u001b[38;5;28;01mwhile\u001b[39;00m \u001b[38;5;28;01mTrue\u001b[39;00m:\n\u001b[0;32m--> 316\u001b[0m     version, status, reason \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_read_status\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    317\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m status \u001b[38;5;241m!=\u001b[39m CONTINUE:\n\u001b[1;32m    318\u001b[0m         \u001b[38;5;28;01mbreak\u001b[39;00m\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/http/client.py:277\u001b[0m, in \u001b[0;36mHTTPResponse._read_status\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    276\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21m_read_status\u001b[39m(\u001b[38;5;28mself\u001b[39m):\n\u001b[0;32m--> 277\u001b[0m     line \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mstr\u001b[39m(\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mfp\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mreadline\u001b[49m\u001b[43m(\u001b[49m\u001b[43m_MAXLINE\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m+\u001b[39;49m\u001b[43m \u001b[49m\u001b[38;5;241;43m1\u001b[39;49m\u001b[43m)\u001b[49m, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124miso-8859-1\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m    278\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(line) \u001b[38;5;241m>\u001b[39m _MAXLINE:\n\u001b[1;32m    279\u001b[0m         \u001b[38;5;28;01mraise\u001b[39;00m LineTooLong(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mstatus line\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/socket.py:669\u001b[0m, in \u001b[0;36mSocketIO.readinto\u001b[0;34m(self, b)\u001b[0m\n\u001b[1;32m    667\u001b[0m \u001b[38;5;28;01mwhile\u001b[39;00m \u001b[38;5;28;01mTrue\u001b[39;00m:\n\u001b[1;32m    668\u001b[0m     \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[0;32m--> 669\u001b[0m         \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_sock\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mrecv_into\u001b[49m\u001b[43m(\u001b[49m\u001b[43mb\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    670\u001b[0m     \u001b[38;5;28;01mexcept\u001b[39;00m timeout:\n\u001b[1;32m    671\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_timeout_occurred \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;01mTrue\u001b[39;00m\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/urllib3/contrib/pyopenssl.py:323\u001b[0m, in \u001b[0;36mWrappedSocket.recv_into\u001b[0;34m(self, *args, **kwargs)\u001b[0m\n\u001b[1;32m    321\u001b[0m         \u001b[38;5;28;01mraise\u001b[39;00m\n\u001b[1;32m    322\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m OpenSSL\u001b[38;5;241m.\u001b[39mSSL\u001b[38;5;241m.\u001b[39mWantReadError:\n\u001b[0;32m--> 323\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[43mutil\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mwait_for_read\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msocket\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msocket\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mgettimeout\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\u001b[43m)\u001b[49m:\n\u001b[1;32m    324\u001b[0m         \u001b[38;5;28;01mraise\u001b[39;00m timeout(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mThe read operation timed out\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m    325\u001b[0m     \u001b[38;5;28;01melse\u001b[39;00m:\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/urllib3/util/wait.py:145\u001b[0m, in \u001b[0;36mwait_for_read\u001b[0;34m(sock, timeout)\u001b[0m\n\u001b[1;32m    141\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mwait_for_read\u001b[39m(sock, timeout\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mNone\u001b[39;00m):\n\u001b[1;32m    142\u001b[0m     \u001b[38;5;124;03m\"\"\"Waits for reading to be available on a given socket.\u001b[39;00m\n\u001b[1;32m    143\u001b[0m \u001b[38;5;124;03m    Returns True if the socket is readable, or False if the timeout expired.\u001b[39;00m\n\u001b[1;32m    144\u001b[0m \u001b[38;5;124;03m    \"\"\"\u001b[39;00m\n\u001b[0;32m--> 145\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mwait_for_socket\u001b[49m\u001b[43m(\u001b[49m\u001b[43msock\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mread\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mtimeout\u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/urllib3/util/wait.py:106\u001b[0m, in \u001b[0;36mpoll_wait_for_socket\u001b[0;34m(sock, read, write, timeout)\u001b[0m\n\u001b[1;32m    103\u001b[0m         t \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m=\u001b[39m \u001b[38;5;241m1000\u001b[39m\n\u001b[1;32m    104\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m poll_obj\u001b[38;5;241m.\u001b[39mpoll(t)\n\u001b[0;32m--> 106\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mbool\u001b[39m(\u001b[43m_retry_on_intr\u001b[49m\u001b[43m(\u001b[49m\u001b[43mdo_poll\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[43m)\u001b[49m)\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/urllib3/util/wait.py:43\u001b[0m, in \u001b[0;36m_retry_on_intr\u001b[0;34m(fn, timeout)\u001b[0m\n\u001b[1;32m     42\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21m_retry_on_intr\u001b[39m(fn, timeout):\n\u001b[0;32m---> 43\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mfn\u001b[49m\u001b[43m(\u001b[49m\u001b[43mtimeout\u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/vendored/urllib3/util/wait.py:104\u001b[0m, in \u001b[0;36mpoll_wait_for_socket.<locals>.do_poll\u001b[0;34m(t)\u001b[0m\n\u001b[1;32m    102\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m t \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[1;32m    103\u001b[0m     t \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m=\u001b[39m \u001b[38;5;241m1000\u001b[39m\n\u001b[0;32m--> 104\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mpoll_obj\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mpoll\u001b[49m\u001b[43m(\u001b[49m\u001b[43mt\u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[0;32m/opt/conda/lib/python3.8/site-packages/snowflake/connector/cursor.py:511\u001b[0m, in \u001b[0;36mSnowflakeCursor._execute_helper.<locals>.interrupt_handler\u001b[0;34m(*_)\u001b[0m\n\u001b[1;32m    508\u001b[0m         \u001b[38;5;28;01mexcept\u001b[39;00m (\u001b[38;5;167;01mValueError\u001b[39;00m, \u001b[38;5;167;01mTypeError\u001b[39;00m):\n\u001b[1;32m    509\u001b[0m             \u001b[38;5;66;03m# ignore failures\u001b[39;00m\n\u001b[1;32m    510\u001b[0m             \u001b[38;5;28;01mpass\u001b[39;00m\n\u001b[0;32m--> 511\u001b[0m \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mKeyboardInterrupt\u001b[39;00m\n",
      "\u001b[0;31mKeyboardInterrupt\u001b[0m: "
     ]
    }
   ],
   "source": [
    "control_age.count()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "075edb55-f980-446d-a7e3-8bb65ef87122",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "case_age= case_session.sql(\"\"\" select distinct masterpatientid,age from (\n",
    "  \n",
    "  ------Diabetes with chronic complications\n",
    "select distinct masterpatientid,'Diabetes_with_chronic_complications' AS Condition_Name, age from (\n",
    "select dataownerid, age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate,age_pat.Age, gender from (\n",
    "select dataownerid, aa.masterpatientid, aa.patientid,aa.age, aa.indexdate, gender from (\n",
    "select dataownerid, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, gender, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select dataownerid, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE, gender ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('E10.3211','E10.3212','E10.3213','E10.3219','E10.3291','E10.3292','E10.3293','E10.3299','E10.3311','E10.3312','E10.3313','E10.3319','E10.3391','E10.3392',\n",
    "                              'E10.3393','E10.3399','E10.3411','E10.3412','E10.3413','E10.3419','E10.3491','E10.3492','E10.3493','E10.3499','E10.3511','E10.3512','E10.3513','E10.3519','E10.352','E10.3521','E10.3522','E10.3523','E10.3529','E10.353','E10.3531','E10.3532','E10.3533','E10.3539','E10.354','E10.3541','E10.3542','E10.3543','E10.3549','E10.355','E10.3551','E10.3552','E10.3553','E10.3559','E10.3591','E10.3592','E10.3593','E10.3599','E10.37','E10.37X1','E10.37X2','E10.37X3','E10.37X9','E11.2','E11.3','E11.31','E11.32','E11.33','E11.34','E11.35','E11.352','E11.353','E11.354','E11.355','E11.37','E11.4','E11.5','E13.2','E13.3','E13.31','E13.32','E13.33','E13.34','E13.35','E13.352','E13.353','E13.354','E13.355','E13.37','E13.4','E13.5','E10.21','E10.22','E11.21','E11.22','E11.29','E13.21','E13.22','E10.2','E10.29','E10.3','E10.31','E10.311','E10.319','E10.32','E10.321','E10.329','E10.33','E10.331','E10.339','E10.34','E10.341','E10.349','E10.35','E10.351','E10.359','E10.36','E10.39','E10.4','E10.40','E10.41','E10.42','E10.43','E10.44','E10.49','E10.5','E10.51','E10.52','E10.59','E11.311','E11.319','E11.321','E11.3211','E11.3212','E11.3213','E11.3219','E11.329','E11.3291','E11.3292','E11.3293','E11.3299','E11.331','E11.3311','E11.3312','E11.3313','E11.3319','E11.339','E11.3391','E11.3392','E11.3393','E11.3399','E11.341','E11.3411','E11.3412','E11.3413','E11.3419','E11.349','E11.3491','E11.3492','E11.3493','E11.3499','E11.351','E11.3511','E11.3512','E11.3513','E11.3519','E11.3521','E11.3522','E11.3523','E11.3529','E11.3531','E11.3532','E11.3533','E11.3539','E11.3541','E11.3542','E11.3543','E11.3549','E11.3551','E11.3552','E11.3553','E11.3559','E11.359','E11.3591','E11.3592','E11.3593','E11.3599','E11.36','E11.37X1','E11.37X2','E11.37X3','E11.37X9','E11.39','E11.40','E11.41','E11.42','E11.43','E11.44','E11.49','E11.51','E11.52','E11.59','E13.29','E13.311','E13.319','E13.321','E13.3211','E13.3212','E13.3213','E13.3219','E13.329','E13.3291','E13.3292','E13.3293','E13.3299','E13.331','E13.3311','E13.3312','E13.3313','E13.3319','E13.339','E13.3391','E13.3392','E13.3393','E13.3399','E13.341','E13.3411','E13.3412','E13.3413','E13.3419','E13.349','E13.3491','E13.3492','E13.3493','E13.3499','E13.351','E13.3511','E13.3512','E13.3513','E13.3519','E13.3521','E13.3522','E13.3523','E13.3529','E13.3531','E13.3532','E13.3533','E13.3539','E13.3541','E13.3542','E13.3543','E13.3549','E13.3551','E13.3552','E13.3553','E13.3559','E13.359','E13.3591','E13.3592','E13.3593','E13.3599',\n",
    "                              'E13.36','E13.37X1','E13.37X2','E13.37X3','E13.37X9','E13.39','E13.40','E13.41','E13.42','E13.43','E13.44','E13.49','E13.51','E13.52','E13.59') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01' \n",
    "             \n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "------ Diabetes without chronic complications\n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Diabetes_without_chronic_complications' AS Condition_Name, age from (\n",
    "select DataOwnerId,age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select DataOwnerId,aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72') ) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('E11.0','E11.1','E11.6','E11.61','E11.62','E11.63','E11.64','E13.0','E13.1','E13.6','E13.61','E13.62','E13.63','E13.64',\n",
    "                              'E10.1','E10.10','E10.11','E10.6','E10.61','E10.610','E10.618','E10.62','E10.620','E10.621','E10.622','E10.628','E10.63','E10.630','E10.638','E10.64','E10.641','E10.649','E10.65','E10.69','E10.8','E10.9','E11.618','E13.618','E11.00','E11.01','E11.10','E11.11','E11.610','E11.620','E11.621','E11.622','E11.628','E11.630','E11.638','E11.641','E11.649','E11.65','E11.69','E11.8','E11.9','E13.00','E13.01','E13.10','E13.11','E13.610',\n",
    "                              'E13.620','E13.621','E13.622','E13.628','E13.630','E13.638',\n",
    "                              'E13.641','E13.649','E13.65','E13.69','E13.8','E13.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "------ Chronic kidney disease (CKD)\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid,'CKD' AS Condition_Name, age from (\n",
    "select DataOwnerId,age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select DataOwnerId, aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('K76.7','E08.22','E08.29','E09.21','E09.22','E10.21','E10.22','E11.21','E11.22','E11.29','E13.21','E13.22',\n",
    "                              'I12.0','I12.9','I13.0','I13.1','I13.10','I13.11','I13.2','M32.14','M32.15','M35.04','N01.0','N01.1','N01.2','N01.3','N01.4','N01.5','N01.6','N01.7','N01.8','N01.9','N02.0','N02.1','N02.2','N02.3','N02.4','N02.5','N02.6','N02.7','N02.8','N02.9','N03.0','N03.1','N03.2','N03.3','N03.4','N03.5','N03.6','N03.7','N03.8','N03.9','N04.0','N04.1','N04.2','N04.3','N04.4','N04.5','N04.6','N04.7','N04.8','N04.9','N05.0','N05.1','N05.2','N05.3','N05.4','N05.5','N05.6','N05.7','N05.8','N05.9','N06.0','N06.1','N06.2','N06.3','N06.4','N06.5','N06.6','N06.7','N06.8','N06.9','N07.0','N07.1','N07.2','N07.3','N07.4','N07.5','N07.6','N07.7','N07.8','N07.9','N08','N11.0','N11.1','N11.8','N11.9','N12','N13.0','N13.4','N13.5','N13.6','N13.70','N13.71','N13.721','N13.722','N13.729','N13.731','N13.732','N13.739','N13.8','N13.9','N14.0','N14.1','N14.2','N14.3','N14.4','N15.0','N15.8','N15.9','N16','N18.1','N18.2','N18.3','N18.4','N18.5','N18.6','N18.9','N19','N25.0','N25.1','N25.81','N25.89','N25.9','N26.1','N26.9','N28.89','N28.9','N29','Q61.02','Q61.11','Q61.19','Q61.2','Q61.3','Q61.4','Q61.5','Q61.8','Q62.0','Q62.10','Q62.11','Q62.12',\n",
    "                              'Q62.2','Q62.31','Q62.32','Q62.39','R94.4','Z49.0','Z49.01','Z49.02','Z49.3','Z49.31','Z49.32','Z99.2') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "             \n",
    "------- Congestive heart failure (CHF)\n",
    "\n",
    "\n",
    "select distinct masterpatientid,'CHF' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate,age_pat.age  from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('P29.0','I42.6','I13.0','I13.2','I09.9','I11.0','I25.5','I42.0','I42.5','I42.7','I42.8','I42.9','I43','I50','I50.1','I50.2','I50.20','I50.21','I50.22','I50.23','I50.3','I50.30','I50.31','I50.32','I50.33','I50.4','I50.40','I50.41','I50.42',\n",
    "                              'I50.43','I50.8','I50.81','I50.810','I50.811','I50.812',\n",
    "                              'I50.813','I50.814','I50.82','I50.83','I50.84','I50.89','I50.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "------ Chronic pulmonary disease\n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid,'Chronic_pulmonary_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate,age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('J41','J44','J47','J60','J61','J62','J62.0','J62.8','J63','J63.0','J63.1','J63.2','J63.3','J63.4','J63.5','J63.6','J64','J65','J66','J67','J68.4','J70.1','J70.3','J40','J41.0','J41.1','J41.8','J42','J43','J43.0','J43.1','J43.2','J43.8','J43.9','J44.0','J44.1','J44.9','J47.0','J47.1','J47.9','J45','J45.2','J45.20','J45.21','J45.22','J45.3','J45.30','J45.31','J45.32','J45.4','J45.40','J45.41','J45.42','J45.5','J45.50','J45.51','J45.52','J45.9','J45.90','J45.901','J45.902','J45.909','J45.99','J45.990','J45.991','J45.998','I27.2','I27.8','I27.81','I27.82','I27.83','I27.89','I27.9','J66.0',\n",
    "                              'J66.1','J66.2','J66.8','J67.0','J67.1','J67.2',\n",
    "                              'J67.3','J67.4','J67.5','J67.6','J67.7','J67.8','J67.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    " UNION ALL            \n",
    "             \n",
    "----- Mild liver disease \n",
    "\n",
    "\n",
    "select distinct masterpatientid,'Mild_liver_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72') ) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('B18','K70.1','K70.3','K71.5','K73','K74','K74.6','K75.8','K76.8','Z94.4','K70.0','K70.10','K70.11','K70.2','K70.9','B18.0','B18.1','B18.2','B18.8','B18.9','K71.3','K71.4','K71.7','K73.0','K73.1','K73.2','K73.8','K73.9','K74.00','K74.01','K74.02','K74.1','K74.2','K74.3','K74.4','K74.5','K74.60','K74.69','K75.2','K75.3','K75.4','K75.81','K75.89',\n",
    "                              'K75.9','K76.0','K76.1','K76.2','K76.3','K76.4','K76.81','K76.89','K76.9','K77','K74.0') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    " UNION ALL            \n",
    "             \n",
    "------Moderate or severe liver disease \n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Moderate_or_severe_liver_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72') ) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('K70.4','K71.1','K72.1','K72.9','K70.40','K70.41','K71.10','K71.11','K71.51','K72.10','K72.11','K72.90',\n",
    "                              'K72.91','K76.5','K76.6','K76.7','K76.81','I85','I85.0','I85.00','I85.01','I85.1','I85.10','I85.11','I86.4') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "------ Dementia\n",
    "\n",
    "\n",
    "select distinct masterpatientid,'Dementia' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('F01','F01.5','F02','F02.8','F03','F03.9','F05','G30','G30.0','G30.1','G30.8','G30.9','G31.0','G31.01','G31.09','G31.1',\n",
    "                              'G31.83','F01.50','F01.51','F02.80','F02.81','F03.90','F03.91') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "  UNION ALL           \n",
    "             \n",
    "----- Myocardial infarction\n",
    "\n",
    "select distinct masterpatientid, 'Myocardial_infarction' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('I21','I21.0','I21.01','I21.02','I21.09','I21.1','I21.11','I21.19','I21.2','I21.21','I21.29','I21.3','I21.4',\n",
    "                              'I21.9','I21.A','I21.A1','I21.A9','I22','I22.0','I22.1','I22.2','I22.8','I22.9','I25.2') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "-------- Peripheral vascular disease \n",
    "\n",
    "select distinct masterpatientid,'Peripheral_vascular_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('Z95.8','Z95.81','Z95.810','Z95.811','Z95.812','Z95.818','Z95.82','Z95.820','Z95.828','Z95.9','I70','I70.0','I70.1',\n",
    "                              'I70.2','I70.20','I70.201','I70.202','I70.203','I70.208','I70.209','I70.21','I70.211','I70.212','I70.213','I70.218','I70.219','I70.22','I70.221','I70.222','I70.223','I70.228','I70.229','I70.23','I70.231','I70.232','I70.233','I70.234','I70.235','I70.238','I70.239','I70.24','I70.241','I70.242','I70.243','I70.244','I70.245','I70.248','I70.249','I70.25','I70.26','I70.261','I70.262','I70.263','I70.268','I70.269','I70.29','I70.291','I70.292','I70.293','I70.298','I70.299','I70.3','I70.30','I70.301','I70.302','I70.303','I70.308','I70.309','I70.31','I70.311','I70.312','I70.313','I70.318','I70.319','I70.32','I70.321','I70.322','I70.323','I70.328','I70.329','I70.33','I70.331','I70.332','I70.333','I70.334','I70.335','I70.338','I70.339','I70.34','I70.341','I70.342','I70.343','I70.344','I70.345','I70.348','I70.349','I70.35','I70.36','I70.361','I70.362','I70.363','I70.368','I70.369','I70.39','I70.391','I70.392','I70.393','I70.398','I70.399','I70.4','I70.40','I70.401','I70.402','I70.403','I70.408','I70.409','I70.41','I70.411','I70.412','I70.413','I70.418','I70.419','I70.42','I70.421','I70.422','I70.423','I70.428','I70.429','I70.43','I70.431','I70.432','I70.433','I70.434','I70.435','I70.438','I70.439','I70.44','I70.441','I70.442','I70.443','I70.444','I70.445','I70.448','I70.449','I70.45','I70.46','I70.461','I70.462','I70.463','I70.468','I70.469','I70.49','I70.491','I70.492','I70.493','I70.498','I70.499','I70.5','I70.50','I70.501','I70.502','I70.503','I70.508','I70.509','I70.51','I70.511','I70.512','I70.513','I70.518','I70.519','I70.52','I70.521','I70.522','I70.523','I70.528','I70.529','I70.53','I70.531','I70.532','I70.533','I70.534','I70.535','I70.538','I70.539','I70.54','I70.541','I70.542','I70.543','I70.544','I70.545','I70.548','I70.549','I70.55','I70.56','I70.561','I70.562','I70.563','I70.568','I70.569','I70.59','I70.591','I70.592','I70.593','I70.598','I70.599','I70.6','I70.60','I70.601','I70.602','I70.603','I70.608','I70.609','I70.61','I70.611','I70.612','I70.613','I70.618','I70.619','I70.62','I70.621','I70.622','I70.623','I70.628','I70.629','I70.63','I70.631','I70.632','I70.633','I70.634','I70.635','I70.638','I70.639','I70.64','I70.641','I70.642','I70.643','I70.644','I70.645','I70.648','I70.649','I70.65','I70.66','I70.661','I70.662','I70.663','I70.668','I70.669','I70.69','I70.691','I70.692','I70.693','I70.698','I70.699','I70.7','I70.70','I70.701','I70.702','I70.703','I70.708','I70.709','I70.71','I70.711','I70.712','I70.713','I70.718','I70.719','I70.72','I70.721','I70.722','I70.723','I70.728','I70.729','I70.73','I70.731','I70.732','I70.733','I70.734','I70.735','I70.738','I70.739','I70.74','I70.741','I70.742','I70.743','I70.744','I70.745','I70.748','I70.749','I70.75','I70.76','I70.761','I70.762','I70.763','I70.768','I70.769','I70.79','I70.791','I70.792','I70.793','I70.798','I70.799','I70.8','I70.9','I70.90','I70.91','I70.92','I71','I71.0','I71.00','I71.01','I71.02','I71.03','I71.1','I71.2','I71.3','I71.4','I71.5','I71.6','I71.8','I71.9','I73.1','I73.8','I73.81','I73.89','I73.9','I75','I75.0','I75.01','I75.011','I75.012','I75.013','I75.019','I75.02','I75.021','I75.022','I75.023','I75.029','I75.8','I75.81','I75.89','I77.1','I77.7',\n",
    "                              'I77.70','I77.71','I77.72','I77.73','I77.74','I77.75','I77.76','I77.77','I77.79','I79.0','K55.1','K55.8','K55.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "  UNION ALL           \n",
    "             \n",
    "------ Cerebrovascular disease \n",
    "\n",
    "\n",
    "select distinct masterpatientid,'Cerebrovascular_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('I63.011','I63.013','I63.019','I63.02','I63.031','I63.032','I63.033','I63.039','I63.09','I63.10','I63.111',\n",
    "                              'I63.113','I63.119','I63.12','I63.131','I63.132','I63.133','I63.139','I63.19','I63.211','I63.212','I63.213',\n",
    "                              'I63.219','I63.22','I63.231','I63.232','I63.233','I63.239','I63.29','I63.30','I63.311','I63.312','I63.313','I63.319','I63.321','I63.322','I63.323','I63.329','I63.331','I63.332','I63.333','I63.339','I63.341','I63.342','I63.343','I63.349','I63.39','I63.40','I63.411','I63.412','I63.012','I63.429','I63.431','I63.432','I63.433','I63.439','I63.441','I63.442','I63.443','I63.449','I63.49','I63.511','I63.512','I63.513','I63.519','I63.521','I63.522','I63.523','I63.529','I63.531','I63.532','I63.533','I63.539','I63.541','I63.542','I63.543','I63.549','I63.59','I63.6','I63.81','I63.89','I63.9','I63.413','I63.419','I63.421','I63.422','I63.423','I67.6','G45.9','I61.2','I61.3','I61.4','I61.5','I61.6','I61.8','I61.9','I62.00','I62.01','I62.02','I62.03','I62.1','I62.9','I67.4','I61.0','I61.1','I67.7','I68.2','G45.0','G45.1','G45.2','G45.3','G45.8','G46.0','G46.1','G46.2','G46.3','G46.4','G46.5','G46.6','G46.7','G46.8','I60.00','I60.01','I60.02','I60.10','I60.11','I60.12','I60.30','I60.31','I60.32','I60.4','I60.50','I60.51','I60.52','I60.6','I60.7','I60.8','I60.9','I63.8','I65.01','I65.02','I65.03','I65.09','I65.1','I65.21','I65.22','I65.23','I65.29','I65.8','I66.02','I66.03','I66.09','I66.11','I66.12','I66.13','I66.19','I66.21','I66.22','I66.23','I66.29','I66.3','I66.8','I66.9','I67.2','I67.81','I67.82','I67.841','I67.848','I67.89','I69.00','I69.012','I69.013','I69.014','I69.015','I69.018','I69.019','I69.020','I69.021','I69.022','I69.023','I69.028','I69.031','I69.032','I69.033','I69.034','I69.039','I69.041','I69.042','I69.043','I69.044','I69.049','I69.051','I69.052','I69.053','I69.054','I69.059','I69.061','I69.062','I69.063','I69.064','I69.065','I69.069','I69.090','I69.091','I69.011','I66.01','I69.111','I69.112','I69.113','I69.114','I69.115','I69.118','I69.119','I69.120','I69.121','I69.122','I69.123','I69.128','I69.131','I69.132','I69.133','I69.134','I69.139','I69.141','I69.142','I69.143','I69.144','I69.149','I69.151','I69.152','I69.153','I69.154','I69.159','I69.161','I69.110','I69.10','I69.164','I69.165','I69.169','I69.190','I69.191','I69.198','I69.20','I69.211','I69.212','I69.213','I69.214','I69.215','I69.219','I69.310','I69.311','I69.220','I69.221','I69.222','I69.223','I69.228','I69.231','I69.232','I69.233','I69.234','I69.239','I69.241','I69.242','I69.243','I69.244','I69.249','I69.251','I69.252','I69.253','I69.254','I69.259','I69.261','I69.262','I69.263','I69.264','I69.265','I69.269','I69.290','I69.291','I69.298','I69.30','I69.312','I69.313','I69.314','I69.315','I69.210','I69.163','I69.320','I69.321','I69.322','I69.323','I69.328','I69.331','I69.332','I69.333','I69.334','I69.339','I69.341','I69.342','I69.343','I69.344','I69.349','I69.351','I69.352','I69.353','I69.354','I69.359','I69.361','I69.362','I69.363','I69.364','I69.365','I69.369','I69.390','I69.391','I69.398','I69.80','I69.811','I69.812','I69.813','I69.814','I69.815','I69.818','I69.819','I69.820','I69.821','I69.822','I69.823','I69.828','I69.831','I69.832','I69.833','I69.834','I69.839','I69.841','I69.842','I69.843','I69.844','I69.849','I69.851','I69.852','I69.319','I69.810','I69.859','I69.861','I69.862','I69.863','I69.864','I69.865','I69.869','I69.890','I69.891','I69.898','I69.90','I69.911','I69.912','I69.913','I69.914','I69.915','I69.918','I69.920','I69.921','I69.922','I69.923','I69.928','I69.931','I69.932','I69.933','I69.934','I69.939','I69.941','I69.942','I69.943','I69.944','I69.949','I69.951','I69.952','I69.953','I69.954','I69.959','I69.961','I69.962','I69.963','I69.964','I69.965','I69.969','I69.990','I69.991','I69.998','I69.910','I69.854','I67.0','I65.9','I69.098','I69.162','I69.010','I63.50','I63.112','I69.853','I69.218','I69.318','I69.919','G45','G45.4','G46','H34.0','I60','I60.0','I60.1','I60.2','I60.3','I60.5','I61','I62','I62.0','I63','I63.0','I63.01','I63.03','I63.1','I63.11','I63.13','I63.2','I63.21','I63.23','I63.3','I63.31','I63.32','I63.33','I63.34','I63.4','I63.41','I63.42','I63.43','I63.44','I63.5','I63.51','I63.52','I63.53','I63.54','I65','I65.0','I65.2','I66','I66.0','I66.1','I66.2','I67','I67.1','I67.3','I67.5','I67.8','I67.83','I67.84','I67.85','I67.850','I67.858','I67.9','I68','I68.0','I68.8','I69','I69.0','I69.01','I69.02','I69.03','I69.04','I69.05','I69.06','I69.09','I69.092','I69.093','I69.1','I69.11','I69.12','I69.13','I69.14','I69.15','I69.16','I69.19','I69.192','I69.193','I69.2','I69.21','I69.22','I69.23','I69.24','I69.25','I69.26','I69.29','I69.292','I69.293','I69.3','I69.31','I69.32','I69.33','I69.34','I69.35','I69.36','I69.39','I69.392','I69.393','I69.8','I69.81','I69.82','I69.83','I69.84','I69.85','I69.86','I69.89','I69.892','I69.893','I69.9',\n",
    "                              'I69.91','I69.92','I69.93','I69.94','I69.95','I69.96','I69.99','I69.992','I69.993','I63.00','I63.20') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "             \n",
    " UNION ALL            \n",
    "             \n",
    "------- Hemiplegia or paraplegia \n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Hemiplegia_or_paraplegia' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('G04.1','G80.0','G80.1','G80.2','G81','G81.0','G81.00','G81.01','G81.02','G81.03','G81.04','G81.1',\n",
    "                              'G81.10','G81.11','G81.12','G81.13','G81.14','G81.9','G81.90','G81.91','G81.92','G81.93','G81.94','G82','G82.2','G82.20','G82.21','G82.22','G82.5','G82.50','G82.51','G82.52','G82.53','G82.54','G83.0','G83.1','G83.10','G83.11','G83.12','G83.13','G83.14','G83.2','G83.20','G83.21','G83.22',\n",
    "                              'G83.23','G83.24','G83.3','G83.30','G83.31','G83.32','G83.33','G83.34','G83.4','G83.9','G11.4') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "\n",
    "\n",
    "UNION ALL\n",
    "\n",
    "------ Rheumatologic disease \n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Rheumatologic_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('M32.14','M35.04','M32.15','M35.81','M06.329','M05','M06','M31.5','M31.6','M35.9','M32','M32.1',\n",
    "                              'M32.10','M32.12','M32.13','M32.19','M32.8','M32.9','M33','M33.0','M33.00','M33.01','M33.02','M33.09','M33.1','M33.10','M33.11','M33.12','M33.19','M33.2','M33.20','M33.21','M33.22','M33.29','M33.9','M33.90','M33.91','M33.92','M33.99','M34','M34.0','M34.1','M34.8','M34.81','M34.89','M34.9','M35.0','M35.00','M35.01','M35.02','M35.03','M35.09','M35.1','M35.2','M35.3','M36.0','M06.339','M05.00','M05.011','M05.012','M05.019','M05.021','M05.022','M05.029','M05.031','M05.032','M05.039','M05.041','M05.042','M05.049','M05.051','M05.052','M05.059','M05.061','M05.062','M05.069','M05.071','M05.072','M05.079','M05.09','M05.112','M05.119','M05.121','M05.122','M05.129','M05.131','M05.132','M05.139','M05.141','M05.142','M05.149','M05.151','M05.152','M05.159','M05.161','M05.162','M05.169','M05.171','M05.172','M05.19','M05.20','M05.211','M05.212','M05.219','M05.221','M05.222','M05.229','M05.231','M05.232','M05.239','M05.241','M05.242','M05.249','M05.251','M05.252','M05.259','M05.261','M05.262','M05.269','M05.271','M05.272','M05.279','M05.29','M05.30','M05.311','M05.312','M05.319','M05.321','M05.322','M05.329','M05.331','M05.332','M05.339','M05.341','M05.342','M05.349','M05.351','M05.352','M05.359','M05.111','M05.369','M05.371','M05.372','M05.379','M05.39','M05.40','M05.411','M05.412','M05.419','M05.421','M05.422','M05.429','M05.431','M05.432','M05.439','M05.441','M05.442','M05.449','M05.451','M05.452','M05.459','M05.461','M05.462','M05.469','M05.471','M05.472','M05.49','M05.511','M05.512','M05.519','M05.521','M05.522','M05.529','M05.531','M05.532','M05.539','M05.541','M05.542','M05.549','M05.551','M05.552','M05.559','M05.561','M05.562','M05.569','M05.571','M05.572','M05.579','M05.59','M05.60','M05.611','M05.612','M05.619','M05.621','M05.622','M05.629','M05.631','M05.50','M05.362','M05.641','M05.642','M05.649','M05.651','M05.652','M05.659','M05.661','M05.662','M05.669','M05.671','M05.672','M05.679','M05.69','M05.70','M05.711','M05.712','M05.719','M05.721','M05.722','M05.729','M05.731','M05.732','M05.739','M05.741','M05.742','M05.749','M05.751','M05.752','M05.759','M05.761','M05.762','M05.769','M05.771','M05.772','M05.779','M05.79','M05.7A','M05.80','M05.811','M05.812','M05.819','M05.821','M05.822','M05.829','M05.831','M05.832','M05.839','M05.841','M05.842','M05.849','M05.851','M05.852','M05.639','M05.862','M05.869','M05.871','M05.872','M05.879','M05.89','M05.8A','M05.9','M06.00','M06.011','M06.012','M06.019','M06.021','M06.022','M06.029','M06.031','M06.032','M06.039','M06.041','M06.042','M06.049','M06.051','M06.052','M06.059','M06.061','M06.062','M06.069','M06.071','M06.072','M06.079','M06.08','M06.09','M06.0A','M06.1','M06.20','M06.211','M06.212','M06.219','M06.221','M06.222','M06.229','M06.231','M06.232','M06.239','M06.241','M06.242','M06.249','M06.251','M06.252','M06.259','M06.261','M06.262','M06.269','M06.271','M06.272','M06.279','M06.28','M06.29','M06.30','M06.311','M06.312','M06.319','M06.321','M06.322','M05.861','M06.351','M06.352','M06.359','M06.361','M06.362','M06.369','M06.371','M06.372','M06.379','M06.38','M06.39','M06.4','M06.80','M06.811','M06.812','M06.819','M06.821','M06.822','M06.829','M06.831','M06.832','M06.839','M06.841','M06.842','M06.849','M06.851','M06.852','M06.859','M06.861','M06.862','M06.869','M06.871','M06.872','M06.879','M06.88','M06.89','M06.8A','M06.9','M06.341','M06.342','M34.83','M05.859','M05.10','M05.179','M05.361','M05.479','M05.632','M06.331','M06.332','M06.349','M35.8','M05.0','M05.01','M05.02','M05.03','M05.04','M05.05','M05.06','M05.07','M05.1','M05.11','M05.12','M05.13','M05.14','M05.15','M05.16','M05.17','M05.2','M05.21','M05.22','M05.23','M05.24','M05.25','M05.26','M05.27','M05.3','M05.31','M05.32','M05.33','M05.34','M05.35','M05.36','M05.37','M05.4','M05.41','M05.42','M05.43','M05.44','M05.45','M05.46','M05.47','M05.5','M05.51','M05.52','M05.53','M05.54','M05.55','M05.56','M05.57','M05.6','M05.61','M05.62','M05.63','M05.64','M05.65','M05.66','M05.67','M05.7','M05.71','M05.72','M05.73','M05.74','M05.75','M05.76','M05.77','M05.8','M05.81','M05.82','M05.83','M05.84','M05.85','M05.86','M05.87','M06.0','M06.01','M06.02','M06.03','M06.04','M06.05','M06.06','M06.07','M06.2','M06.21','M06.22','M06.23','M06.24','M06.25','M06.26','M06.27','M06.3','M06.31','M06.32','M06.33','M06.34','M06.35','M06.36','M06.37','M06.8','M06.81','M06.82','M06.83','M06.84','M06.85','M06.86','M06.87','M32.0','M32.11','M33.03','M33.13','M33.93','M34.2','M34.82','M35','M35.05','M35.06',\n",
    "                              'M35.07','M35.08','M35.0A','M35.0B','M35.0C','M35.4','M35.5','M35.6','M35.7','M35.89') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "------ Peptic ulcer disease \n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Peptic_ulcer_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('K25','K25.0','K25.1','K25.2','K25.3','K25.4','K25.5','K25.6','K25.7','K25.9','K26','K26.0','K26.1','K26.2',\n",
    "                              'K26.3','K26.4','K26.5','K26.6','K26.7','K26.9','K27','K27.0','K27.1','K27.2','K27.3',\n",
    "                              'K27.4','K27.5','K27.6','K27.7','K27.9','K28','K28.0','K28.1','K28.2','K28.3','K28.4','K28.5','K28.6','K28.7','K28.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "             \n",
    " UNION ALL            \n",
    "             \n",
    "------Any malignancy, including leukemia and lymphoma \n",
    "\n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Any_malignancy_including_leukemia_and_lymphoma' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('C00.0','C00.1','C70','C70.1','C70.9','C71.0','C71','C71.1','C71.2','C71.3','C71.4','C71.5',\n",
    "                              'C71.6','C71.7','C71.8','C71.9','C72.0','C72.1','C72.20','C72.2','C72.21','C72.22','C72.30','C72.3','C72.31',\n",
    "                              'C72.32','C72.40','C72.4','C72.41','C72.42','C72.50','C72.5','C72.59','C72.9','C00','C00.2','C00.3','C00.4',\n",
    "                              'C00.5','C00.6','C00.8','C00.9','C02.0','C02.1','C01','C02','C02.2','C02.4','C02.8','C70.0','C03.0','C03.1',\n",
    "                              'C03.9','C04.8','C04.9','C04','C05.0','C05.1','C05.2','C05','C05.8','C05.9','C06.0','C06.1','C06.2','C06',\n",
    "                              'C06.80','C06.89','C06.9','C08.0','C08.1','C08.9','C07','C08','C09.0','C09.1','C09.8','C09','C09.9','C10.0','C10.1','C10.2','C10','C10.3','C10.4','C10.8','C10.9','C11.0','C11.1','C11.2','C11','C11.3','C11.8','C11.9','C13.0','C13.1','C13.2','C12','C13','C13.8','C13.9','C14.0','C14.2','C14.8','C15.3','C15.4','C15.5','C15','C15.8','C15.9','C16.0','C16.1','C16.2','C16','C16.3','C16.4','C16.5','C16.8','C16.9','C17.0','C17.1','C17.2','C17','C03','C18.0','C18.1','C18.2','C18','C18.3','C18.4','C18.5','C18.6','C18.7','C18.8','C18.9','C21.0','C21.1','C21.2','C19','C20','C21','C22.0','C22.1','C22.2','C22.3','C22','C22.4','C22.7','C22.9','C24.0','C24.1','C24.8','C24.9','C23','C24','C25.0','C25.1','C25.2','C25.3','C25','C25.4','C25.7','C25.8','C25.9','C26.0','C26.1','C26.9','C30.0','C26','C30.1','C31.0','C31.1','C30','C31.2','C31.3','C31','C31.9','C32.0','C32.1','C32.2','C32.3','C32','C32.8','C32.9','C34.00','C34.01','C34.02','C34.10','C33','C34','C34.0','C34.11','C34.12','C34.2','C34.1','C34.30','C34.31','C34.32','C34.3','C34.8','C34.91','C34.9','C34.92','C38.0','C37','C38','C38.1','C38.2','C38.3','C38.4','C38.8','C39.0','C39','C39.9','C40.00','C40','C40.0','C40.01','C40.02','C40.10','C40.1','C40.11','C40.12','C40.20','C40.2','C40.21','C40.22','C40.30','C40.3','C40.31','C40.32','C40.80','C40.81','C40.82','C40.90','C40.9','C40.91','C40.92','C41.0','C41','C41.1','C41.2','C41.3','C41.4','C41.9','C43.0','C43','C43.10','C43.1','C43.11','C43.111','C43.112','C43.12','C43.121','C43.122','C43.20','C43.2','C43.21','C43.22','C43.30','C43.3','C43.31','C43.39','C43.4','C43.51','C43.5','C43.52','C43.62','C43.70','C43.71','C43.72','C43.7','C43.8','C43.9','C45.0','C45.1','C45.2','C45','C45.7','C45.9','C46.0','C46.1','C46.2','C46','C46.3','C46.4','C46.50','C46.51','C46.52','C46.5','C46.7','C46.9','C47.10','C47.11','C47.12','C47','C47.20','C47.21','C47.22','C47.3','C47.2','C47.4','C47.5','C47.6','C47.8','C47.9','C48.0','C48.1','C48.2','C48.8','C48','C49.0','C49.10','C49.11','C49.12','C49','C49.20','C49.1','C49.21','C49.22','C49.3','C49.2','C49.4','C49.5','C49.6','C49.8','C49.9','C49.A0','C49.A1','C49.A2','C49.A4','C49.A','C49.A5','C43.6','C4A.10','C4A.11','C4A.111','C4A.112','C4A.12','C4A.121','C4A.122','C4A.20','C4A.21','C4A.22','C4A.30','C4A.2','C4A.31','C4A.39','C4A.4','C4A.3','C4A.51','C4A.52','C4A.59','C4A.60','C4A.5','C4A.61','C4A.62','C4A.71','C4A.72','C4A.8','C4A.9','C4A.7','C50.011','C50.012','C50.019','C50.021','C50.022','C50','C50.0','C50.01','C50.029','C50.111','C50.112','C50.02','C50.119','C50.121','C50.122','C50.1','C50.11','C50.211','C50.212','C50.219','C50.12','C50.221','C50.222','C50.2','C50.21','C50.229','C50.311','C50.312','C50.22','C50.319','C50.321','C50.322','C50.3','C50.31','C50.329','C57.02','C50.32','C4A','C50.412','C50.419','C50.421','C50.422','C50.42','C50.429','C50.511','C50.512','C50.5','C50.51','C50.519','C50.521','C50.522','C50.52','C50.529','C50.611','C50.612','C50.6','C50.61','C50.621','C50.622','C50.62','C50.629','C50.811','C50.812','C50.8','C50.81','C50.819','C50.821','C50.822','C50.82','C50.829','C50.911','C50.912','C50.9','C50.91','C50.919','C50.921','C50.922','C50.92','C50.929','C51.0','C51.1','C51','C51.2','C51.8','C51.9','C53.0','C53.1','C52','C53','C53.9','C54.0','C54.1','C54','C54.2','C54.3','C54.8','C54.9','C56.1','C56.2','C55','C56','C56.9','C57.00','C57.01','C57','C57.0','C50.41','C57.12','C57.21','C57.2','C57.22','C57.3','C57.4','C57.7','C57.8','C57.9','C60.0','C58','C60','C60.1','C60.2','C60.8','C60.9','C62.00','C57.10','C62','C62.0','C62.01','C62.02','C62.10','C62.1','C62.11','C62.12','C62.92','C63.00','C63.01','C63','C63.0','C63.02','C63.10','C63.11','C63.1','C63.12','C63.2','C63.7','C63.8','C63.9','C64.1','C64.2','C64','C64.9','C65.1','C65.2','C65','C65.9','C66.1','C66.2','C66','C66.9','C67.0','C67.1','C67','C67.2','C67.3','C67.5','C67.6','C67.7','C67.8','C67.9','C68.0','C68.1','C68','C68.8','C68.9','C69.00','C69.01','C69','C69.0','C69.02','C57.11','C69.12','C69.20','C69.21','C69.22','C69.30','C69.2','C69.31','C69.32','C69.40','C69.3','C69.41','C69.42','C69.50','C69.4','C69.51','C69.52','C69.60','C69.5','C69.61','C69.62','C69.81','C69.6','C69.82','C69.90','C69.91','C69.92','C74.00','C74.01','C69.9','C74.02','C74.10','C74.11','C73','C74','C74.0','C74.12','C74.90','C74.91','C74.1','C74.92','C75.0','C75.1','C74.9','C75.2','C75.3','C75.4','C75','C75.8','C75.9','C76.0','C76.1','C76.2','C76.3','C76.40','C76','C76.41','C76.42','C76.50','C76.51','C76.4','C76.52','C76.8','C7A.00','C76.5','C7A.010','C7A.011','C7A.012','C7A.020','C7A','C7A.0','C7A.01','C7A.02','C69.1','C7A.025','C7A.026','C7A.090','C7A.091','C7A.09','C7A.092','C7A.093','C7A.094','C7A.095','C7A.096','C7A.098','C7A.1','C7A.8','C80.0','C80.1','C80','C80.2','C7A.023','C7A.024','C81.01','C81.02','C81.03','C81','C81.04','C81.05','C81.06','C81.07','C81.08','C81.09','C81.10','C81.11','C81.12','C81.13','C81.1','C81.14','C81.16','C81.17','C81.18','C81.19','C81.20','C81.21','C81.22','C81.23','C81.2','C81.24','C81.25','C81.26','C81.27','C81.28','C81.29','C81.30','C81.31','C81.32','C81.33','C81.3','C81.34','C81.35','C81.36','C81.37','C81.38','C81.39','C81.40','C81.41','C81.42','C81.43','C81.4','C81.44','C81.45','C81.46','C81.70','C81.71','C81.72','C81.7','C81.73','C81.74','C81.75','C81.76','C81.77','C81.78','C81.79','C81.90','C81.91','C81.92','C81.9','C81.93','C81.94','C81.95','C81.96','C81.97','C81.98','C81.99','C82.00','C82.02','C82.03','C82','C82.0','C82.04','C82.05','C82.06','C82.07','C82.08','C82.09','C82.10','C82.11','C82.12','C82.1','C82.13','C82.14','C82.15','C82.16','C82.17','C82.18','C82.19','C82.20','C82.22','C82.23','C82.2','C82.25','C82.26','C82.27','C82.28','C82.29','C82.30','C82.31','C82.32','C82.33','C82.3','C82.34','C82.35','C82.36','C82.37','C82.38','C82.39','C82.40','C82.4','C82.43','C82.45','C82.46','C82.47','C82.48','C82.49','C82.50','C82.51','C82.52','C82.53','C82.5','C82.54','C82.55','C82.56','C82.57','C82.58','C82.59','C82.60','C82.61','C82.62','C82.63','C82.6','C82.65','C82.66','C82.67','C82.68','C82.69','C82.80','C82.81','C82.82','C82.83','C82.8','C82.84','C82.85','C82.86','C82.87','C82.88','C82.89','C82.90','C82.91','C82.92','C82.93','C82.9','C82.94','C82.95','C82.96','C82.97','C82.98','C82.99','C83.00','C83.01','C83.02','C83.03','C83','C83.0','C83.05','C83.06','C83.07','C83.08','C83.09','C83.10','C83.11','C83.12','C83.13','C83.1','C83.15','C83.16','C83.17','C83.18','C83.19','C83.30','C83.3','C83.31','C83.32','C83.33','C83.34','C83.36','C83.37','C83.38','C83.50','C83.51','C83.5','C83.52','C83.54','C83.57','C83.58','C83.59','C83.70','C83.71','C83.7','C83.72','C83.73','C83.74','C83.75','C83.76','C83.77','C83.78','C83.79','C83.80','C83.81','C83.8','C83.82','C83.83','C83.84','C83.85','C83.86','C83.87','C83.88','C83.89','C83.90','C83.91','C83.9','C83.92','C83.93','C83.94','C83.95','C83.96','C83.97','C83.98','C83.99','C84.00','C84.01','C84','C84.0','C84.02','C84.03','C84.04','C84.05','C84.06','C84.07','C84.08','C84.10','C84.11','C84.1','C84.12','C84.13','C84.16','C84.17','C84.18','C84.19','C84.40','C84.41','C84.42','C84.4','C84.43','C84.44','C84.45','C84.46','C84.47','C84.48','C84.49','C84.60','C84.62','C84.63','C84.6','C84.64','C84.65','C84.66','C84.67','C84.68','C84.69','C84.70','C84.71','C84.72','C84.7','C84.73','C84.74','C84.75','C84.76','C84.77','C84.78','C84.79','C84.90','C84.91','C84.92','C84.9','C84.93','C84.94','C84.95','C84.96','C84.97','C84.98','C84.99','C84.A0','C84.A1','C84.A2','C84.A','C84.A3','C84.A4','C84.A6','C84.A7','C84.A8','C84.A9','C84.Z2','C84.Z3','C84.Z4','C84.Z','C84.Z5','C84.Z6','C84.Z7','C84.Z8','C84.Z9','C85.10','C85.11','C85.12','C85.13','C85','C85.1','C85.14','C85.16','C85.17','C85.18','C85.19','C85.20','C85.21','C85.22','C85.23','C85.2','C85.24','C85.25','C85.26','C85.27','C85.28','C85.29','C85.80','C85.81','C85.82','C85.83','C85.8','C85.84','C85.85','C85.86','C85.87','C85.88','C85.89','C85.90','C85.91','C85.92','C85.93','C85.9','C85.94','C85.96','C85.97','C85.98','C85.99','C86.0','C86.1','C86.2','C86.3','C86','C86.4','C86.5','C86.6','C88.2','C88.3','C88','C88.0','C90.01','C90.02','C90.11','C90','C90.0','C90.12','C90.20','C90.21','C90.1','C90.22','C90.30','C90.31','C90.2','C90.32','C91.00','C91.01','C90.3','C91.02','C91.11','C91.12','C91','C91.0','C91.30','C91.31','C91.32','C91.1','C91.40','C91.41','C91.3','C91.42','C91.50','C91.51','C91.4','C91.52','C91.60','C91.61','C91.5','C91.62','C91.90','C91.91','C91.6','C91.92','C91.A0','C91.A1','C91.9','C91.A2','C91.Z0','C91.Z1','C91.A','C91.Z2','C92.01','C92.02','C91.Z','C92.10','C92.11','C92.12','C92','C92.0','C92.20','C92.21','C92.1','C92.22','C92.30','C92.31','C92.2','C92.32','C92.40','C92.41','C92.3','C92.42','C92.50','C92.51','C92.4','C92.5','C92.62','C92.6','C92.90','C92.91','C92.9','C92.92','C92.A1','C92.A2','C92.A','C92.Z0','C92.Z1','C92.Z2','C92.Z','C93.00','C93.01','C93.02','C93','C93.0','C93.10','C93.11','C93.12','C93.1','C93.30','C93.31','C93.32','C93.3','C93.90','C93.91','C93.92','C93.9','C93.Z0','C93.Z1','C93.Z2','C93.Z','C94.01','C94.02','C94.20','C94','C94.0','C94.21','C94.22','C94.2','C94.30','C94.31','C94.32','C94.3','C94.40','C94.41','C94.42','C94.4','C94.6','C94.80','C94.81','C94.82','C94.8','C95.00','C95.01','C95.02','C95','C95.0','C95.11','C95.12','C95.90','C95.1','C95.91','C95.92','C95.9','C96.0','C96.20','C96.21','C96','C96.22','C96.2','C02.9','C81.0','C96.5','C96.6','C96.A','C96.Z','C72','C04.0','C17.3','C06.8','C14','C22.8','C31.8','C34.80','C34.90','C43.59','C43.60','C40.8','C49.A3','C49.A9','C47.1','C50.129','C50.619','C4A.1','C4A.6','C53.8','C50.4','C57.20','C67.4','C57.1','C69.10','C75.5','C69.8','C7A.021','C7A.022','C81.15','C7A.019','C81.47','C81.48','C82.01','C82.24','C82.41','C82.64','C83.04','C83.14','C83.39','C83.53','C83.55','C83.56','C84.09','C84.14',\n",
    "                              'C84.61','C96.4','C62.9','C62.90','C84.Z0','C85.15','C85.95','C88.8','C88.9','C91.10','C92.00','C92.52','C92.60','C94.00','C95.10','C96.29','C96.9','C61','C56.3','C84.7A','D45','C02.3','C04.1','C16.6','C17.8','C17.9','C21.8','C34.81','C34.82','C43.61','C47.0','C4A.0','C4A.70','C50.411','C62.91','C69.11','C69.80','C7A.029','C81.00','C81.49','C82.21','C82.42','C82.44',\n",
    "                              'C83.35','C84.15','C84.A5','C84.Z1','C88.4','C90.00','C90.10','C92.61','C92.A0') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "  \n",
    " UNION ALL \n",
    "  \n",
    "---- Metastatic solid tumor \n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Metastatic_solid_tumor' AS Condition_Name, age from (\n",
    "select DataOwnerId,age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select DataOwnerId,aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('C79.63','C77','C77.0','C77.1','C77.2','C77.3','C77.4','C77.5','C77.8','C77.9','C78','C78.0','C78.00','C78.01','C78.02','C78.1','C78.2','C78.3','C78.30','C78.39','C78.4','C78.5','C78.6','C78.7','C78.8','C78.80','C78.89','C79','C79.0','C79.00','C79.01','C79.02','C79.1','C79.10','C79.11','C79.19','C79.2','C79.3','C79.31','C79.32','C79.4','C79.40','C79.49','C79.5','C79.51','C79.52','C79.6','C79.60','C79.61','C79.62','C79.7','C79.70','C79.71','C79.72','C79.8','C79.81','C79.82','C79.89',\n",
    "                              'C79.9','C7B','C7B.0','C7B.00','C7B.01','C7B.02','C7B.03','C7B.04','C7B.09','C7B.1','C7B.8') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "\n",
    "UNION ALL\n",
    "             \n",
    "----- AIDS/HIV \n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'AIDS_HIV' AS Condition_Name, age from (\n",
    "select DataOwnerId,age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select DataOwnerId,aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('B20','B97.35','O98.7','O98.71','O98.711','O98.712','O98.713','O98.719','O98.72','O98.73','Z21') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "  ) order by masterpatientid \"\"\")\n",
    "case_age= case_session.sql(\"\"\" select distinct masterpatientid, Condition_Name,age from (\n",
    "  \n",
    "  ------Diabetes with chronic complications\n",
    "select distinct masterpatientid,'Diabetes_with_chronic_complications' AS Condition_Name, age from (\n",
    "select dataownerid, age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate,age_pat.Age, gender from (\n",
    "select dataownerid, aa.masterpatientid, aa.patientid,aa.age, aa.indexdate, gender from (\n",
    "select dataownerid, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, gender, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select dataownerid, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE, gender ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE, gender\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('E10.3211','E10.3212','E10.3213','E10.3219','E10.3291','E10.3292','E10.3293','E10.3299','E10.3311','E10.3312','E10.3313','E10.3319','E10.3391','E10.3392',\n",
    "                              'E10.3393','E10.3399','E10.3411','E10.3412','E10.3413','E10.3419','E10.3491','E10.3492','E10.3493','E10.3499','E10.3511','E10.3512','E10.3513','E10.3519','E10.352','E10.3521','E10.3522','E10.3523','E10.3529','E10.353','E10.3531','E10.3532','E10.3533','E10.3539','E10.354','E10.3541','E10.3542','E10.3543','E10.3549','E10.355','E10.3551','E10.3552','E10.3553','E10.3559','E10.3591','E10.3592','E10.3593','E10.3599','E10.37','E10.37X1','E10.37X2','E10.37X3','E10.37X9','E11.2','E11.3','E11.31','E11.32','E11.33','E11.34','E11.35','E11.352','E11.353','E11.354','E11.355','E11.37','E11.4','E11.5','E13.2','E13.3','E13.31','E13.32','E13.33','E13.34','E13.35','E13.352','E13.353','E13.354','E13.355','E13.37','E13.4','E13.5','E10.21','E10.22','E11.21','E11.22','E11.29','E13.21','E13.22','E10.2','E10.29','E10.3','E10.31','E10.311','E10.319','E10.32','E10.321','E10.329','E10.33','E10.331','E10.339','E10.34','E10.341','E10.349','E10.35','E10.351','E10.359','E10.36','E10.39','E10.4','E10.40','E10.41','E10.42','E10.43','E10.44','E10.49','E10.5','E10.51','E10.52','E10.59','E11.311','E11.319','E11.321','E11.3211','E11.3212','E11.3213','E11.3219','E11.329','E11.3291','E11.3292','E11.3293','E11.3299','E11.331','E11.3311','E11.3312','E11.3313','E11.3319','E11.339','E11.3391','E11.3392','E11.3393','E11.3399','E11.341','E11.3411','E11.3412','E11.3413','E11.3419','E11.349','E11.3491','E11.3492','E11.3493','E11.3499','E11.351','E11.3511','E11.3512','E11.3513','E11.3519','E11.3521','E11.3522','E11.3523','E11.3529','E11.3531','E11.3532','E11.3533','E11.3539','E11.3541','E11.3542','E11.3543','E11.3549','E11.3551','E11.3552','E11.3553','E11.3559','E11.359','E11.3591','E11.3592','E11.3593','E11.3599','E11.36','E11.37X1','E11.37X2','E11.37X3','E11.37X9','E11.39','E11.40','E11.41','E11.42','E11.43','E11.44','E11.49','E11.51','E11.52','E11.59','E13.29','E13.311','E13.319','E13.321','E13.3211','E13.3212','E13.3213','E13.3219','E13.329','E13.3291','E13.3292','E13.3293','E13.3299','E13.331','E13.3311','E13.3312','E13.3313','E13.3319','E13.339','E13.3391','E13.3392','E13.3393','E13.3399','E13.341','E13.3411','E13.3412','E13.3413','E13.3419','E13.349','E13.3491','E13.3492','E13.3493','E13.3499','E13.351','E13.3511','E13.3512','E13.3513','E13.3519','E13.3521','E13.3522','E13.3523','E13.3529','E13.3531','E13.3532','E13.3533','E13.3539','E13.3541','E13.3542','E13.3543','E13.3549','E13.3551','E13.3552','E13.3553','E13.3559','E13.359','E13.3591','E13.3592','E13.3593','E13.3599',\n",
    "                              'E13.36','E13.37X1','E13.37X2','E13.37X3','E13.37X9','E13.39','E13.40','E13.41','E13.42','E13.43','E13.44','E13.49','E13.51','E13.52','E13.59') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01' \n",
    "             \n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "------ Diabetes without chronic complications\n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Diabetes_without_chronic_complications' AS Condition_Name, age from (\n",
    "select DataOwnerId,age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select DataOwnerId,aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72') ) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('E11.0','E11.1','E11.6','E11.61','E11.62','E11.63','E11.64','E13.0','E13.1','E13.6','E13.61','E13.62','E13.63','E13.64',\n",
    "                              'E10.1','E10.10','E10.11','E10.6','E10.61','E10.610','E10.618','E10.62','E10.620','E10.621','E10.622','E10.628','E10.63','E10.630','E10.638','E10.64','E10.641','E10.649','E10.65','E10.69','E10.8','E10.9','E11.618','E13.618','E11.00','E11.01','E11.10','E11.11','E11.610','E11.620','E11.621','E11.622','E11.628','E11.630','E11.638','E11.641','E11.649','E11.65','E11.69','E11.8','E11.9','E13.00','E13.01','E13.10','E13.11','E13.610',\n",
    "                              'E13.620','E13.621','E13.622','E13.628','E13.630','E13.638',\n",
    "                              'E13.641','E13.649','E13.65','E13.69','E13.8','E13.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "------ Chronic kidney disease (CKD)\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid,'CKD' AS Condition_Name, age from (\n",
    "select DataOwnerId,age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select DataOwnerId, aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('K76.7','E08.22','E08.29','E09.21','E09.22','E10.21','E10.22','E11.21','E11.22','E11.29','E13.21','E13.22',\n",
    "                              'I12.0','I12.9','I13.0','I13.1','I13.10','I13.11','I13.2','M32.14','M32.15','M35.04','N01.0','N01.1','N01.2','N01.3','N01.4','N01.5','N01.6','N01.7','N01.8','N01.9','N02.0','N02.1','N02.2','N02.3','N02.4','N02.5','N02.6','N02.7','N02.8','N02.9','N03.0','N03.1','N03.2','N03.3','N03.4','N03.5','N03.6','N03.7','N03.8','N03.9','N04.0','N04.1','N04.2','N04.3','N04.4','N04.5','N04.6','N04.7','N04.8','N04.9','N05.0','N05.1','N05.2','N05.3','N05.4','N05.5','N05.6','N05.7','N05.8','N05.9','N06.0','N06.1','N06.2','N06.3','N06.4','N06.5','N06.6','N06.7','N06.8','N06.9','N07.0','N07.1','N07.2','N07.3','N07.4','N07.5','N07.6','N07.7','N07.8','N07.9','N08','N11.0','N11.1','N11.8','N11.9','N12','N13.0','N13.4','N13.5','N13.6','N13.70','N13.71','N13.721','N13.722','N13.729','N13.731','N13.732','N13.739','N13.8','N13.9','N14.0','N14.1','N14.2','N14.3','N14.4','N15.0','N15.8','N15.9','N16','N18.1','N18.2','N18.3','N18.4','N18.5','N18.6','N18.9','N19','N25.0','N25.1','N25.81','N25.89','N25.9','N26.1','N26.9','N28.89','N28.9','N29','Q61.02','Q61.11','Q61.19','Q61.2','Q61.3','Q61.4','Q61.5','Q61.8','Q62.0','Q62.10','Q62.11','Q62.12',\n",
    "                              'Q62.2','Q62.31','Q62.32','Q62.39','R94.4','Z49.0','Z49.01','Z49.02','Z49.3','Z49.31','Z49.32','Z99.2') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "             \n",
    "------- Congestive heart failure (CHF)\n",
    "\n",
    "\n",
    "select distinct masterpatientid,'CHF' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate,age_pat.age  from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('P29.0','I42.6','I13.0','I13.2','I09.9','I11.0','I25.5','I42.0','I42.5','I42.7','I42.8','I42.9','I43','I50','I50.1','I50.2','I50.20','I50.21','I50.22','I50.23','I50.3','I50.30','I50.31','I50.32','I50.33','I50.4','I50.40','I50.41','I50.42',\n",
    "                              'I50.43','I50.8','I50.81','I50.810','I50.811','I50.812',\n",
    "                              'I50.813','I50.814','I50.82','I50.83','I50.84','I50.89','I50.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "------ Chronic pulmonary disease\n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid,'Chronic_pulmonary_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate,age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('J41','J44','J47','J60','J61','J62','J62.0','J62.8','J63','J63.0','J63.1','J63.2','J63.3','J63.4','J63.5','J63.6','J64','J65','J66','J67','J68.4','J70.1','J70.3','J40','J41.0','J41.1','J41.8','J42','J43','J43.0','J43.1','J43.2','J43.8','J43.9','J44.0','J44.1','J44.9','J47.0','J47.1','J47.9','J45','J45.2','J45.20','J45.21','J45.22','J45.3','J45.30','J45.31','J45.32','J45.4','J45.40','J45.41','J45.42','J45.5','J45.50','J45.51','J45.52','J45.9','J45.90','J45.901','J45.902','J45.909','J45.99','J45.990','J45.991','J45.998','I27.2','I27.8','I27.81','I27.82','I27.83','I27.89','I27.9','J66.0',\n",
    "                              'J66.1','J66.2','J66.8','J67.0','J67.1','J67.2',\n",
    "                              'J67.3','J67.4','J67.5','J67.6','J67.7','J67.8','J67.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    " UNION ALL            \n",
    "             \n",
    "----- Mild liver disease \n",
    "\n",
    "\n",
    "select distinct masterpatientid,'Mild_liver_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72') ) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('B18','K70.1','K70.3','K71.5','K73','K74','K74.6','K75.8','K76.8','Z94.4','K70.0','K70.10','K70.11','K70.2','K70.9','B18.0','B18.1','B18.2','B18.8','B18.9','K71.3','K71.4','K71.7','K73.0','K73.1','K73.2','K73.8','K73.9','K74.00','K74.01','K74.02','K74.1','K74.2','K74.3','K74.4','K74.5','K74.60','K74.69','K75.2','K75.3','K75.4','K75.81','K75.89',\n",
    "                              'K75.9','K76.0','K76.1','K76.2','K76.3','K76.4','K76.81','K76.89','K76.9','K77','K74.0') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    " UNION ALL            \n",
    "             \n",
    "------Moderate or severe liver disease \n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Moderate_or_severe_liver_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72') ) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('K70.4','K71.1','K72.1','K72.9','K70.40','K70.41','K71.10','K71.11','K71.51','K72.10','K72.11','K72.90',\n",
    "                              'K72.91','K76.5','K76.6','K76.7','K76.81','I85','I85.0','I85.00','I85.01','I85.1','I85.10','I85.11','I86.4') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "------ Dementia\n",
    "\n",
    "\n",
    "select distinct masterpatientid,'Dementia' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('F01','F01.5','F02','F02.8','F03','F03.9','F05','G30','G30.0','G30.1','G30.8','G30.9','G31.0','G31.01','G31.09','G31.1',\n",
    "                              'G31.83','F01.50','F01.51','F02.80','F02.81','F03.90','F03.91') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "  UNION ALL           \n",
    "             \n",
    "----- Myocardial infarction\n",
    "\n",
    "select distinct masterpatientid, 'Myocardial_infarction' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('I21','I21.0','I21.01','I21.02','I21.09','I21.1','I21.11','I21.19','I21.2','I21.21','I21.29','I21.3','I21.4',\n",
    "                              'I21.9','I21.A','I21.A1','I21.A9','I22','I22.0','I22.1','I22.2','I22.8','I22.9','I25.2') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "-------- Peripheral vascular disease \n",
    "\n",
    "select distinct masterpatientid,'Peripheral_vascular_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('Z95.8','Z95.81','Z95.810','Z95.811','Z95.812','Z95.818','Z95.82','Z95.820','Z95.828','Z95.9','I70','I70.0','I70.1',\n",
    "                              'I70.2','I70.20','I70.201','I70.202','I70.203','I70.208','I70.209','I70.21','I70.211','I70.212','I70.213','I70.218','I70.219','I70.22','I70.221','I70.222','I70.223','I70.228','I70.229','I70.23','I70.231','I70.232','I70.233','I70.234','I70.235','I70.238','I70.239','I70.24','I70.241','I70.242','I70.243','I70.244','I70.245','I70.248','I70.249','I70.25','I70.26','I70.261','I70.262','I70.263','I70.268','I70.269','I70.29','I70.291','I70.292','I70.293','I70.298','I70.299','I70.3','I70.30','I70.301','I70.302','I70.303','I70.308','I70.309','I70.31','I70.311','I70.312','I70.313','I70.318','I70.319','I70.32','I70.321','I70.322','I70.323','I70.328','I70.329','I70.33','I70.331','I70.332','I70.333','I70.334','I70.335','I70.338','I70.339','I70.34','I70.341','I70.342','I70.343','I70.344','I70.345','I70.348','I70.349','I70.35','I70.36','I70.361','I70.362','I70.363','I70.368','I70.369','I70.39','I70.391','I70.392','I70.393','I70.398','I70.399','I70.4','I70.40','I70.401','I70.402','I70.403','I70.408','I70.409','I70.41','I70.411','I70.412','I70.413','I70.418','I70.419','I70.42','I70.421','I70.422','I70.423','I70.428','I70.429','I70.43','I70.431','I70.432','I70.433','I70.434','I70.435','I70.438','I70.439','I70.44','I70.441','I70.442','I70.443','I70.444','I70.445','I70.448','I70.449','I70.45','I70.46','I70.461','I70.462','I70.463','I70.468','I70.469','I70.49','I70.491','I70.492','I70.493','I70.498','I70.499','I70.5','I70.50','I70.501','I70.502','I70.503','I70.508','I70.509','I70.51','I70.511','I70.512','I70.513','I70.518','I70.519','I70.52','I70.521','I70.522','I70.523','I70.528','I70.529','I70.53','I70.531','I70.532','I70.533','I70.534','I70.535','I70.538','I70.539','I70.54','I70.541','I70.542','I70.543','I70.544','I70.545','I70.548','I70.549','I70.55','I70.56','I70.561','I70.562','I70.563','I70.568','I70.569','I70.59','I70.591','I70.592','I70.593','I70.598','I70.599','I70.6','I70.60','I70.601','I70.602','I70.603','I70.608','I70.609','I70.61','I70.611','I70.612','I70.613','I70.618','I70.619','I70.62','I70.621','I70.622','I70.623','I70.628','I70.629','I70.63','I70.631','I70.632','I70.633','I70.634','I70.635','I70.638','I70.639','I70.64','I70.641','I70.642','I70.643','I70.644','I70.645','I70.648','I70.649','I70.65','I70.66','I70.661','I70.662','I70.663','I70.668','I70.669','I70.69','I70.691','I70.692','I70.693','I70.698','I70.699','I70.7','I70.70','I70.701','I70.702','I70.703','I70.708','I70.709','I70.71','I70.711','I70.712','I70.713','I70.718','I70.719','I70.72','I70.721','I70.722','I70.723','I70.728','I70.729','I70.73','I70.731','I70.732','I70.733','I70.734','I70.735','I70.738','I70.739','I70.74','I70.741','I70.742','I70.743','I70.744','I70.745','I70.748','I70.749','I70.75','I70.76','I70.761','I70.762','I70.763','I70.768','I70.769','I70.79','I70.791','I70.792','I70.793','I70.798','I70.799','I70.8','I70.9','I70.90','I70.91','I70.92','I71','I71.0','I71.00','I71.01','I71.02','I71.03','I71.1','I71.2','I71.3','I71.4','I71.5','I71.6','I71.8','I71.9','I73.1','I73.8','I73.81','I73.89','I73.9','I75','I75.0','I75.01','I75.011','I75.012','I75.013','I75.019','I75.02','I75.021','I75.022','I75.023','I75.029','I75.8','I75.81','I75.89','I77.1','I77.7',\n",
    "                              'I77.70','I77.71','I77.72','I77.73','I77.74','I77.75','I77.76','I77.77','I77.79','I79.0','K55.1','K55.8','K55.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "  UNION ALL           \n",
    "             \n",
    "------ Cerebrovascular disease \n",
    "\n",
    "\n",
    "select distinct masterpatientid,'Cerebrovascular_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('I63.011','I63.013','I63.019','I63.02','I63.031','I63.032','I63.033','I63.039','I63.09','I63.10','I63.111',\n",
    "                              'I63.113','I63.119','I63.12','I63.131','I63.132','I63.133','I63.139','I63.19','I63.211','I63.212','I63.213',\n",
    "                              'I63.219','I63.22','I63.231','I63.232','I63.233','I63.239','I63.29','I63.30','I63.311','I63.312','I63.313','I63.319','I63.321','I63.322','I63.323','I63.329','I63.331','I63.332','I63.333','I63.339','I63.341','I63.342','I63.343','I63.349','I63.39','I63.40','I63.411','I63.412','I63.012','I63.429','I63.431','I63.432','I63.433','I63.439','I63.441','I63.442','I63.443','I63.449','I63.49','I63.511','I63.512','I63.513','I63.519','I63.521','I63.522','I63.523','I63.529','I63.531','I63.532','I63.533','I63.539','I63.541','I63.542','I63.543','I63.549','I63.59','I63.6','I63.81','I63.89','I63.9','I63.413','I63.419','I63.421','I63.422','I63.423','I67.6','G45.9','I61.2','I61.3','I61.4','I61.5','I61.6','I61.8','I61.9','I62.00','I62.01','I62.02','I62.03','I62.1','I62.9','I67.4','I61.0','I61.1','I67.7','I68.2','G45.0','G45.1','G45.2','G45.3','G45.8','G46.0','G46.1','G46.2','G46.3','G46.4','G46.5','G46.6','G46.7','G46.8','I60.00','I60.01','I60.02','I60.10','I60.11','I60.12','I60.30','I60.31','I60.32','I60.4','I60.50','I60.51','I60.52','I60.6','I60.7','I60.8','I60.9','I63.8','I65.01','I65.02','I65.03','I65.09','I65.1','I65.21','I65.22','I65.23','I65.29','I65.8','I66.02','I66.03','I66.09','I66.11','I66.12','I66.13','I66.19','I66.21','I66.22','I66.23','I66.29','I66.3','I66.8','I66.9','I67.2','I67.81','I67.82','I67.841','I67.848','I67.89','I69.00','I69.012','I69.013','I69.014','I69.015','I69.018','I69.019','I69.020','I69.021','I69.022','I69.023','I69.028','I69.031','I69.032','I69.033','I69.034','I69.039','I69.041','I69.042','I69.043','I69.044','I69.049','I69.051','I69.052','I69.053','I69.054','I69.059','I69.061','I69.062','I69.063','I69.064','I69.065','I69.069','I69.090','I69.091','I69.011','I66.01','I69.111','I69.112','I69.113','I69.114','I69.115','I69.118','I69.119','I69.120','I69.121','I69.122','I69.123','I69.128','I69.131','I69.132','I69.133','I69.134','I69.139','I69.141','I69.142','I69.143','I69.144','I69.149','I69.151','I69.152','I69.153','I69.154','I69.159','I69.161','I69.110','I69.10','I69.164','I69.165','I69.169','I69.190','I69.191','I69.198','I69.20','I69.211','I69.212','I69.213','I69.214','I69.215','I69.219','I69.310','I69.311','I69.220','I69.221','I69.222','I69.223','I69.228','I69.231','I69.232','I69.233','I69.234','I69.239','I69.241','I69.242','I69.243','I69.244','I69.249','I69.251','I69.252','I69.253','I69.254','I69.259','I69.261','I69.262','I69.263','I69.264','I69.265','I69.269','I69.290','I69.291','I69.298','I69.30','I69.312','I69.313','I69.314','I69.315','I69.210','I69.163','I69.320','I69.321','I69.322','I69.323','I69.328','I69.331','I69.332','I69.333','I69.334','I69.339','I69.341','I69.342','I69.343','I69.344','I69.349','I69.351','I69.352','I69.353','I69.354','I69.359','I69.361','I69.362','I69.363','I69.364','I69.365','I69.369','I69.390','I69.391','I69.398','I69.80','I69.811','I69.812','I69.813','I69.814','I69.815','I69.818','I69.819','I69.820','I69.821','I69.822','I69.823','I69.828','I69.831','I69.832','I69.833','I69.834','I69.839','I69.841','I69.842','I69.843','I69.844','I69.849','I69.851','I69.852','I69.319','I69.810','I69.859','I69.861','I69.862','I69.863','I69.864','I69.865','I69.869','I69.890','I69.891','I69.898','I69.90','I69.911','I69.912','I69.913','I69.914','I69.915','I69.918','I69.920','I69.921','I69.922','I69.923','I69.928','I69.931','I69.932','I69.933','I69.934','I69.939','I69.941','I69.942','I69.943','I69.944','I69.949','I69.951','I69.952','I69.953','I69.954','I69.959','I69.961','I69.962','I69.963','I69.964','I69.965','I69.969','I69.990','I69.991','I69.998','I69.910','I69.854','I67.0','I65.9','I69.098','I69.162','I69.010','I63.50','I63.112','I69.853','I69.218','I69.318','I69.919','G45','G45.4','G46','H34.0','I60','I60.0','I60.1','I60.2','I60.3','I60.5','I61','I62','I62.0','I63','I63.0','I63.01','I63.03','I63.1','I63.11','I63.13','I63.2','I63.21','I63.23','I63.3','I63.31','I63.32','I63.33','I63.34','I63.4','I63.41','I63.42','I63.43','I63.44','I63.5','I63.51','I63.52','I63.53','I63.54','I65','I65.0','I65.2','I66','I66.0','I66.1','I66.2','I67','I67.1','I67.3','I67.5','I67.8','I67.83','I67.84','I67.85','I67.850','I67.858','I67.9','I68','I68.0','I68.8','I69','I69.0','I69.01','I69.02','I69.03','I69.04','I69.05','I69.06','I69.09','I69.092','I69.093','I69.1','I69.11','I69.12','I69.13','I69.14','I69.15','I69.16','I69.19','I69.192','I69.193','I69.2','I69.21','I69.22','I69.23','I69.24','I69.25','I69.26','I69.29','I69.292','I69.293','I69.3','I69.31','I69.32','I69.33','I69.34','I69.35','I69.36','I69.39','I69.392','I69.393','I69.8','I69.81','I69.82','I69.83','I69.84','I69.85','I69.86','I69.89','I69.892','I69.893','I69.9',\n",
    "                              'I69.91','I69.92','I69.93','I69.94','I69.95','I69.96','I69.99','I69.992','I69.993','I63.00','I63.20') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "             \n",
    " UNION ALL            \n",
    "             \n",
    "------- Hemiplegia or paraplegia \n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Hemiplegia_or_paraplegia' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId, evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('G04.1','G80.0','G80.1','G80.2','G81','G81.0','G81.00','G81.01','G81.02','G81.03','G81.04','G81.1',\n",
    "                              'G81.10','G81.11','G81.12','G81.13','G81.14','G81.9','G81.90','G81.91','G81.92','G81.93','G81.94','G82','G82.2','G82.20','G82.21','G82.22','G82.5','G82.50','G82.51','G82.52','G82.53','G82.54','G83.0','G83.1','G83.10','G83.11','G83.12','G83.13','G83.14','G83.2','G83.20','G83.21','G83.22',\n",
    "                              'G83.23','G83.24','G83.3','G83.30','G83.31','G83.32','G83.33','G83.34','G83.4','G83.9','G11.4') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "\n",
    "\n",
    "UNION ALL\n",
    "\n",
    "------ Rheumatologic disease \n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Rheumatologic_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('M32.14','M35.04','M32.15','M35.81','M06.329','M05','M06','M31.5','M31.6','M35.9','M32','M32.1',\n",
    "                              'M32.10','M32.12','M32.13','M32.19','M32.8','M32.9','M33','M33.0','M33.00','M33.01','M33.02','M33.09','M33.1','M33.10','M33.11','M33.12','M33.19','M33.2','M33.20','M33.21','M33.22','M33.29','M33.9','M33.90','M33.91','M33.92','M33.99','M34','M34.0','M34.1','M34.8','M34.81','M34.89','M34.9','M35.0','M35.00','M35.01','M35.02','M35.03','M35.09','M35.1','M35.2','M35.3','M36.0','M06.339','M05.00','M05.011','M05.012','M05.019','M05.021','M05.022','M05.029','M05.031','M05.032','M05.039','M05.041','M05.042','M05.049','M05.051','M05.052','M05.059','M05.061','M05.062','M05.069','M05.071','M05.072','M05.079','M05.09','M05.112','M05.119','M05.121','M05.122','M05.129','M05.131','M05.132','M05.139','M05.141','M05.142','M05.149','M05.151','M05.152','M05.159','M05.161','M05.162','M05.169','M05.171','M05.172','M05.19','M05.20','M05.211','M05.212','M05.219','M05.221','M05.222','M05.229','M05.231','M05.232','M05.239','M05.241','M05.242','M05.249','M05.251','M05.252','M05.259','M05.261','M05.262','M05.269','M05.271','M05.272','M05.279','M05.29','M05.30','M05.311','M05.312','M05.319','M05.321','M05.322','M05.329','M05.331','M05.332','M05.339','M05.341','M05.342','M05.349','M05.351','M05.352','M05.359','M05.111','M05.369','M05.371','M05.372','M05.379','M05.39','M05.40','M05.411','M05.412','M05.419','M05.421','M05.422','M05.429','M05.431','M05.432','M05.439','M05.441','M05.442','M05.449','M05.451','M05.452','M05.459','M05.461','M05.462','M05.469','M05.471','M05.472','M05.49','M05.511','M05.512','M05.519','M05.521','M05.522','M05.529','M05.531','M05.532','M05.539','M05.541','M05.542','M05.549','M05.551','M05.552','M05.559','M05.561','M05.562','M05.569','M05.571','M05.572','M05.579','M05.59','M05.60','M05.611','M05.612','M05.619','M05.621','M05.622','M05.629','M05.631','M05.50','M05.362','M05.641','M05.642','M05.649','M05.651','M05.652','M05.659','M05.661','M05.662','M05.669','M05.671','M05.672','M05.679','M05.69','M05.70','M05.711','M05.712','M05.719','M05.721','M05.722','M05.729','M05.731','M05.732','M05.739','M05.741','M05.742','M05.749','M05.751','M05.752','M05.759','M05.761','M05.762','M05.769','M05.771','M05.772','M05.779','M05.79','M05.7A','M05.80','M05.811','M05.812','M05.819','M05.821','M05.822','M05.829','M05.831','M05.832','M05.839','M05.841','M05.842','M05.849','M05.851','M05.852','M05.639','M05.862','M05.869','M05.871','M05.872','M05.879','M05.89','M05.8A','M05.9','M06.00','M06.011','M06.012','M06.019','M06.021','M06.022','M06.029','M06.031','M06.032','M06.039','M06.041','M06.042','M06.049','M06.051','M06.052','M06.059','M06.061','M06.062','M06.069','M06.071','M06.072','M06.079','M06.08','M06.09','M06.0A','M06.1','M06.20','M06.211','M06.212','M06.219','M06.221','M06.222','M06.229','M06.231','M06.232','M06.239','M06.241','M06.242','M06.249','M06.251','M06.252','M06.259','M06.261','M06.262','M06.269','M06.271','M06.272','M06.279','M06.28','M06.29','M06.30','M06.311','M06.312','M06.319','M06.321','M06.322','M05.861','M06.351','M06.352','M06.359','M06.361','M06.362','M06.369','M06.371','M06.372','M06.379','M06.38','M06.39','M06.4','M06.80','M06.811','M06.812','M06.819','M06.821','M06.822','M06.829','M06.831','M06.832','M06.839','M06.841','M06.842','M06.849','M06.851','M06.852','M06.859','M06.861','M06.862','M06.869','M06.871','M06.872','M06.879','M06.88','M06.89','M06.8A','M06.9','M06.341','M06.342','M34.83','M05.859','M05.10','M05.179','M05.361','M05.479','M05.632','M06.331','M06.332','M06.349','M35.8','M05.0','M05.01','M05.02','M05.03','M05.04','M05.05','M05.06','M05.07','M05.1','M05.11','M05.12','M05.13','M05.14','M05.15','M05.16','M05.17','M05.2','M05.21','M05.22','M05.23','M05.24','M05.25','M05.26','M05.27','M05.3','M05.31','M05.32','M05.33','M05.34','M05.35','M05.36','M05.37','M05.4','M05.41','M05.42','M05.43','M05.44','M05.45','M05.46','M05.47','M05.5','M05.51','M05.52','M05.53','M05.54','M05.55','M05.56','M05.57','M05.6','M05.61','M05.62','M05.63','M05.64','M05.65','M05.66','M05.67','M05.7','M05.71','M05.72','M05.73','M05.74','M05.75','M05.76','M05.77','M05.8','M05.81','M05.82','M05.83','M05.84','M05.85','M05.86','M05.87','M06.0','M06.01','M06.02','M06.03','M06.04','M06.05','M06.06','M06.07','M06.2','M06.21','M06.22','M06.23','M06.24','M06.25','M06.26','M06.27','M06.3','M06.31','M06.32','M06.33','M06.34','M06.35','M06.36','M06.37','M06.8','M06.81','M06.82','M06.83','M06.84','M06.85','M06.86','M06.87','M32.0','M32.11','M33.03','M33.13','M33.93','M34.2','M34.82','M35','M35.05','M35.06',\n",
    "                              'M35.07','M35.08','M35.0A','M35.0B','M35.0C','M35.4','M35.5','M35.6','M35.7','M35.89') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "UNION ALL             \n",
    "             \n",
    "------ Peptic ulcer disease \n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Peptic_ulcer_disease' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('K25','K25.0','K25.1','K25.2','K25.3','K25.4','K25.5','K25.6','K25.7','K25.9','K26','K26.0','K26.1','K26.2',\n",
    "                              'K26.3','K26.4','K26.5','K26.6','K26.7','K26.9','K27','K27.0','K27.1','K27.2','K27.3',\n",
    "                              'K27.4','K27.5','K27.6','K27.7','K27.9','K28','K28.0','K28.1','K28.2','K28.3','K28.4','K28.5','K28.6','K28.7','K28.9') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "             \n",
    " UNION ALL            \n",
    "             \n",
    "------Any malignancy, including leukemia and lymphoma \n",
    "\n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Any_malignancy_including_leukemia_and_lymphoma' AS Condition_Name, age from (\n",
    "select age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId, evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('C00.0','C00.1','C70','C70.1','C70.9','C71.0','C71','C71.1','C71.2','C71.3','C71.4','C71.5',\n",
    "                              'C71.6','C71.7','C71.8','C71.9','C72.0','C72.1','C72.20','C72.2','C72.21','C72.22','C72.30','C72.3','C72.31',\n",
    "                              'C72.32','C72.40','C72.4','C72.41','C72.42','C72.50','C72.5','C72.59','C72.9','C00','C00.2','C00.3','C00.4',\n",
    "                              'C00.5','C00.6','C00.8','C00.9','C02.0','C02.1','C01','C02','C02.2','C02.4','C02.8','C70.0','C03.0','C03.1',\n",
    "                              'C03.9','C04.8','C04.9','C04','C05.0','C05.1','C05.2','C05','C05.8','C05.9','C06.0','C06.1','C06.2','C06',\n",
    "                              'C06.80','C06.89','C06.9','C08.0','C08.1','C08.9','C07','C08','C09.0','C09.1','C09.8','C09','C09.9','C10.0','C10.1','C10.2','C10','C10.3','C10.4','C10.8','C10.9','C11.0','C11.1','C11.2','C11','C11.3','C11.8','C11.9','C13.0','C13.1','C13.2','C12','C13','C13.8','C13.9','C14.0','C14.2','C14.8','C15.3','C15.4','C15.5','C15','C15.8','C15.9','C16.0','C16.1','C16.2','C16','C16.3','C16.4','C16.5','C16.8','C16.9','C17.0','C17.1','C17.2','C17','C03','C18.0','C18.1','C18.2','C18','C18.3','C18.4','C18.5','C18.6','C18.7','C18.8','C18.9','C21.0','C21.1','C21.2','C19','C20','C21','C22.0','C22.1','C22.2','C22.3','C22','C22.4','C22.7','C22.9','C24.0','C24.1','C24.8','C24.9','C23','C24','C25.0','C25.1','C25.2','C25.3','C25','C25.4','C25.7','C25.8','C25.9','C26.0','C26.1','C26.9','C30.0','C26','C30.1','C31.0','C31.1','C30','C31.2','C31.3','C31','C31.9','C32.0','C32.1','C32.2','C32.3','C32','C32.8','C32.9','C34.00','C34.01','C34.02','C34.10','C33','C34','C34.0','C34.11','C34.12','C34.2','C34.1','C34.30','C34.31','C34.32','C34.3','C34.8','C34.91','C34.9','C34.92','C38.0','C37','C38','C38.1','C38.2','C38.3','C38.4','C38.8','C39.0','C39','C39.9','C40.00','C40','C40.0','C40.01','C40.02','C40.10','C40.1','C40.11','C40.12','C40.20','C40.2','C40.21','C40.22','C40.30','C40.3','C40.31','C40.32','C40.80','C40.81','C40.82','C40.90','C40.9','C40.91','C40.92','C41.0','C41','C41.1','C41.2','C41.3','C41.4','C41.9','C43.0','C43','C43.10','C43.1','C43.11','C43.111','C43.112','C43.12','C43.121','C43.122','C43.20','C43.2','C43.21','C43.22','C43.30','C43.3','C43.31','C43.39','C43.4','C43.51','C43.5','C43.52','C43.62','C43.70','C43.71','C43.72','C43.7','C43.8','C43.9','C45.0','C45.1','C45.2','C45','C45.7','C45.9','C46.0','C46.1','C46.2','C46','C46.3','C46.4','C46.50','C46.51','C46.52','C46.5','C46.7','C46.9','C47.10','C47.11','C47.12','C47','C47.20','C47.21','C47.22','C47.3','C47.2','C47.4','C47.5','C47.6','C47.8','C47.9','C48.0','C48.1','C48.2','C48.8','C48','C49.0','C49.10','C49.11','C49.12','C49','C49.20','C49.1','C49.21','C49.22','C49.3','C49.2','C49.4','C49.5','C49.6','C49.8','C49.9','C49.A0','C49.A1','C49.A2','C49.A4','C49.A','C49.A5','C43.6','C4A.10','C4A.11','C4A.111','C4A.112','C4A.12','C4A.121','C4A.122','C4A.20','C4A.21','C4A.22','C4A.30','C4A.2','C4A.31','C4A.39','C4A.4','C4A.3','C4A.51','C4A.52','C4A.59','C4A.60','C4A.5','C4A.61','C4A.62','C4A.71','C4A.72','C4A.8','C4A.9','C4A.7','C50.011','C50.012','C50.019','C50.021','C50.022','C50','C50.0','C50.01','C50.029','C50.111','C50.112','C50.02','C50.119','C50.121','C50.122','C50.1','C50.11','C50.211','C50.212','C50.219','C50.12','C50.221','C50.222','C50.2','C50.21','C50.229','C50.311','C50.312','C50.22','C50.319','C50.321','C50.322','C50.3','C50.31','C50.329','C57.02','C50.32','C4A','C50.412','C50.419','C50.421','C50.422','C50.42','C50.429','C50.511','C50.512','C50.5','C50.51','C50.519','C50.521','C50.522','C50.52','C50.529','C50.611','C50.612','C50.6','C50.61','C50.621','C50.622','C50.62','C50.629','C50.811','C50.812','C50.8','C50.81','C50.819','C50.821','C50.822','C50.82','C50.829','C50.911','C50.912','C50.9','C50.91','C50.919','C50.921','C50.922','C50.92','C50.929','C51.0','C51.1','C51','C51.2','C51.8','C51.9','C53.0','C53.1','C52','C53','C53.9','C54.0','C54.1','C54','C54.2','C54.3','C54.8','C54.9','C56.1','C56.2','C55','C56','C56.9','C57.00','C57.01','C57','C57.0','C50.41','C57.12','C57.21','C57.2','C57.22','C57.3','C57.4','C57.7','C57.8','C57.9','C60.0','C58','C60','C60.1','C60.2','C60.8','C60.9','C62.00','C57.10','C62','C62.0','C62.01','C62.02','C62.10','C62.1','C62.11','C62.12','C62.92','C63.00','C63.01','C63','C63.0','C63.02','C63.10','C63.11','C63.1','C63.12','C63.2','C63.7','C63.8','C63.9','C64.1','C64.2','C64','C64.9','C65.1','C65.2','C65','C65.9','C66.1','C66.2','C66','C66.9','C67.0','C67.1','C67','C67.2','C67.3','C67.5','C67.6','C67.7','C67.8','C67.9','C68.0','C68.1','C68','C68.8','C68.9','C69.00','C69.01','C69','C69.0','C69.02','C57.11','C69.12','C69.20','C69.21','C69.22','C69.30','C69.2','C69.31','C69.32','C69.40','C69.3','C69.41','C69.42','C69.50','C69.4','C69.51','C69.52','C69.60','C69.5','C69.61','C69.62','C69.81','C69.6','C69.82','C69.90','C69.91','C69.92','C74.00','C74.01','C69.9','C74.02','C74.10','C74.11','C73','C74','C74.0','C74.12','C74.90','C74.91','C74.1','C74.92','C75.0','C75.1','C74.9','C75.2','C75.3','C75.4','C75','C75.8','C75.9','C76.0','C76.1','C76.2','C76.3','C76.40','C76','C76.41','C76.42','C76.50','C76.51','C76.4','C76.52','C76.8','C7A.00','C76.5','C7A.010','C7A.011','C7A.012','C7A.020','C7A','C7A.0','C7A.01','C7A.02','C69.1','C7A.025','C7A.026','C7A.090','C7A.091','C7A.09','C7A.092','C7A.093','C7A.094','C7A.095','C7A.096','C7A.098','C7A.1','C7A.8','C80.0','C80.1','C80','C80.2','C7A.023','C7A.024','C81.01','C81.02','C81.03','C81','C81.04','C81.05','C81.06','C81.07','C81.08','C81.09','C81.10','C81.11','C81.12','C81.13','C81.1','C81.14','C81.16','C81.17','C81.18','C81.19','C81.20','C81.21','C81.22','C81.23','C81.2','C81.24','C81.25','C81.26','C81.27','C81.28','C81.29','C81.30','C81.31','C81.32','C81.33','C81.3','C81.34','C81.35','C81.36','C81.37','C81.38','C81.39','C81.40','C81.41','C81.42','C81.43','C81.4','C81.44','C81.45','C81.46','C81.70','C81.71','C81.72','C81.7','C81.73','C81.74','C81.75','C81.76','C81.77','C81.78','C81.79','C81.90','C81.91','C81.92','C81.9','C81.93','C81.94','C81.95','C81.96','C81.97','C81.98','C81.99','C82.00','C82.02','C82.03','C82','C82.0','C82.04','C82.05','C82.06','C82.07','C82.08','C82.09','C82.10','C82.11','C82.12','C82.1','C82.13','C82.14','C82.15','C82.16','C82.17','C82.18','C82.19','C82.20','C82.22','C82.23','C82.2','C82.25','C82.26','C82.27','C82.28','C82.29','C82.30','C82.31','C82.32','C82.33','C82.3','C82.34','C82.35','C82.36','C82.37','C82.38','C82.39','C82.40','C82.4','C82.43','C82.45','C82.46','C82.47','C82.48','C82.49','C82.50','C82.51','C82.52','C82.53','C82.5','C82.54','C82.55','C82.56','C82.57','C82.58','C82.59','C82.60','C82.61','C82.62','C82.63','C82.6','C82.65','C82.66','C82.67','C82.68','C82.69','C82.80','C82.81','C82.82','C82.83','C82.8','C82.84','C82.85','C82.86','C82.87','C82.88','C82.89','C82.90','C82.91','C82.92','C82.93','C82.9','C82.94','C82.95','C82.96','C82.97','C82.98','C82.99','C83.00','C83.01','C83.02','C83.03','C83','C83.0','C83.05','C83.06','C83.07','C83.08','C83.09','C83.10','C83.11','C83.12','C83.13','C83.1','C83.15','C83.16','C83.17','C83.18','C83.19','C83.30','C83.3','C83.31','C83.32','C83.33','C83.34','C83.36','C83.37','C83.38','C83.50','C83.51','C83.5','C83.52','C83.54','C83.57','C83.58','C83.59','C83.70','C83.71','C83.7','C83.72','C83.73','C83.74','C83.75','C83.76','C83.77','C83.78','C83.79','C83.80','C83.81','C83.8','C83.82','C83.83','C83.84','C83.85','C83.86','C83.87','C83.88','C83.89','C83.90','C83.91','C83.9','C83.92','C83.93','C83.94','C83.95','C83.96','C83.97','C83.98','C83.99','C84.00','C84.01','C84','C84.0','C84.02','C84.03','C84.04','C84.05','C84.06','C84.07','C84.08','C84.10','C84.11','C84.1','C84.12','C84.13','C84.16','C84.17','C84.18','C84.19','C84.40','C84.41','C84.42','C84.4','C84.43','C84.44','C84.45','C84.46','C84.47','C84.48','C84.49','C84.60','C84.62','C84.63','C84.6','C84.64','C84.65','C84.66','C84.67','C84.68','C84.69','C84.70','C84.71','C84.72','C84.7','C84.73','C84.74','C84.75','C84.76','C84.77','C84.78','C84.79','C84.90','C84.91','C84.92','C84.9','C84.93','C84.94','C84.95','C84.96','C84.97','C84.98','C84.99','C84.A0','C84.A1','C84.A2','C84.A','C84.A3','C84.A4','C84.A6','C84.A7','C84.A8','C84.A9','C84.Z2','C84.Z3','C84.Z4','C84.Z','C84.Z5','C84.Z6','C84.Z7','C84.Z8','C84.Z9','C85.10','C85.11','C85.12','C85.13','C85','C85.1','C85.14','C85.16','C85.17','C85.18','C85.19','C85.20','C85.21','C85.22','C85.23','C85.2','C85.24','C85.25','C85.26','C85.27','C85.28','C85.29','C85.80','C85.81','C85.82','C85.83','C85.8','C85.84','C85.85','C85.86','C85.87','C85.88','C85.89','C85.90','C85.91','C85.92','C85.93','C85.9','C85.94','C85.96','C85.97','C85.98','C85.99','C86.0','C86.1','C86.2','C86.3','C86','C86.4','C86.5','C86.6','C88.2','C88.3','C88','C88.0','C90.01','C90.02','C90.11','C90','C90.0','C90.12','C90.20','C90.21','C90.1','C90.22','C90.30','C90.31','C90.2','C90.32','C91.00','C91.01','C90.3','C91.02','C91.11','C91.12','C91','C91.0','C91.30','C91.31','C91.32','C91.1','C91.40','C91.41','C91.3','C91.42','C91.50','C91.51','C91.4','C91.52','C91.60','C91.61','C91.5','C91.62','C91.90','C91.91','C91.6','C91.92','C91.A0','C91.A1','C91.9','C91.A2','C91.Z0','C91.Z1','C91.A','C91.Z2','C92.01','C92.02','C91.Z','C92.10','C92.11','C92.12','C92','C92.0','C92.20','C92.21','C92.1','C92.22','C92.30','C92.31','C92.2','C92.32','C92.40','C92.41','C92.3','C92.42','C92.50','C92.51','C92.4','C92.5','C92.62','C92.6','C92.90','C92.91','C92.9','C92.92','C92.A1','C92.A2','C92.A','C92.Z0','C92.Z1','C92.Z2','C92.Z','C93.00','C93.01','C93.02','C93','C93.0','C93.10','C93.11','C93.12','C93.1','C93.30','C93.31','C93.32','C93.3','C93.90','C93.91','C93.92','C93.9','C93.Z0','C93.Z1','C93.Z2','C93.Z','C94.01','C94.02','C94.20','C94','C94.0','C94.21','C94.22','C94.2','C94.30','C94.31','C94.32','C94.3','C94.40','C94.41','C94.42','C94.4','C94.6','C94.80','C94.81','C94.82','C94.8','C95.00','C95.01','C95.02','C95','C95.0','C95.11','C95.12','C95.90','C95.1','C95.91','C95.92','C95.9','C96.0','C96.20','C96.21','C96','C96.22','C96.2','C02.9','C81.0','C96.5','C96.6','C96.A','C96.Z','C72','C04.0','C17.3','C06.8','C14','C22.8','C31.8','C34.80','C34.90','C43.59','C43.60','C40.8','C49.A3','C49.A9','C47.1','C50.129','C50.619','C4A.1','C4A.6','C53.8','C50.4','C57.20','C67.4','C57.1','C69.10','C75.5','C69.8','C7A.021','C7A.022','C81.15','C7A.019','C81.47','C81.48','C82.01','C82.24','C82.41','C82.64','C83.04','C83.14','C83.39','C83.53','C83.55','C83.56','C84.09','C84.14',\n",
    "                              'C84.61','C96.4','C62.9','C62.90','C84.Z0','C85.15','C85.95','C88.8','C88.9','C91.10','C92.00','C92.52','C92.60','C94.00','C95.10','C96.29','C96.9','C61','C56.3','C84.7A','D45','C02.3','C04.1','C16.6','C17.8','C17.9','C21.8','C34.81','C34.82','C43.61','C47.0','C4A.0','C4A.70','C50.411','C62.91','C69.11','C69.80','C7A.029','C81.00','C81.49','C82.21','C82.42','C82.44',\n",
    "                              'C83.35','C84.15','C84.A5','C84.Z1','C88.4','C90.00','C90.10','C92.61','C92.A0') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "             \n",
    "  \n",
    " UNION ALL \n",
    "  \n",
    "---- Metastatic solid tumor \n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'Metastatic_solid_tumor' AS Condition_Name, age from (\n",
    "select DataOwnerId,age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select DataOwnerId,aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('C79.63','C77','C77.0','C77.1','C77.2','C77.3','C77.4','C77.5','C77.8','C77.9','C78','C78.0','C78.00','C78.01','C78.02','C78.1','C78.2','C78.3','C78.30','C78.39','C78.4','C78.5','C78.6','C78.7','C78.8','C78.80','C78.89','C79','C79.0','C79.00','C79.01','C79.02','C79.1','C79.10','C79.11','C79.19','C79.2','C79.3','C79.31','C79.32','C79.4','C79.40','C79.49','C79.5','C79.51','C79.52','C79.6','C79.60','C79.61','C79.62','C79.7','C79.70','C79.71','C79.72','C79.8','C79.81','C79.82','C79.89',\n",
    "                              'C79.9','C7B','C7B.0','C7B.00','C7B.01','C7B.02','C7B.03','C7B.04','C7B.09','C7B.1','C7B.8') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "             \n",
    "\n",
    "UNION ALL\n",
    "             \n",
    "----- AIDS/HIV \n",
    "\n",
    "\n",
    "\n",
    "select distinct masterpatientid, 'AIDS_HIV' AS Condition_Name, age from (\n",
    "select DataOwnerId,age_pat.masterpatientid, age_pat.patientid, age_pat.indexdate, age_pat.age from (\n",
    "select DataOwnerId,aa.masterpatientid, aa.patientid,aa.age, aa.indexdate from (\n",
    "select DataOwnerId,evu_age.masterpatientid, evu_age.patientid,evu_age.indexdate, DATEDIFF(year, evu_age.birthdate,evu_age.indexdate) as Age from\n",
    "(select DataOwnerId,evu_exp.masterpatientid, evu_exp.patientid, evu_exp.BIRTHDATE ,evu_exp.indexdate, row_number () \n",
    "over (partition by masterpatientid order by indexdate ASC) as row1 from\n",
    "(SELECT pr.DataOwnerId, \n",
    "p.MasterPatientId, pxdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PROCEDURES\" pr\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON pr.DataOwnerId = p.DataOwnerId AND pr.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON pr.DataOwnerId = e.DataOwnerId AND pr.EncounterId = e.EncounterId\n",
    "WHERE (pr.SourcePxCodeDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR pr.PxCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    "\n",
    "UNION\n",
    " \n",
    "SELECT b.DataOwnerId,\n",
    "p.MasterPatientId, SERVICEDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_BILLINGS\" b ON p.DataOwnerId = b.DataOwnerId AND b.PatientId = p.PatientId \n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON b.DataOwnerId = e.DataOwnerId AND b.EncounterId = e.EncounterId\n",
    "WHERE (b.BillingProcedureDescription ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%') OR b.MedicationName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR b.BillingProcedureCode ILIKE ANY ('Q0220','Q0221','M0220','M0221'))\n",
    " \n",
    "UNION\n",
    "\n",
    "SELECT mo.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, orderdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDORDERS\" mo\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mo.DataOwnerId = p.DataOwnerId AND mo.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON mo.DataOwnerId = e.DataOwnerId AND mo.EncounterId = e.EncounterId\n",
    "WHERE (mo.SourceRxMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR (mo.SourceRxCodeType = 'NDC' AND REPLACE(mo.SourceRxCode, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                                                            , '00310744202','00310889501','00310106101','00310886102')))\n",
    "\n",
    "UNION\n",
    "\n",
    "SELECT mf.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId, FILLEDDATE as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDFILLS\" mf\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON mf.DataOwnerId = p.DataOwnerId AND mf.PatientId = p.PatientId\n",
    "WHERE mf.FilledDate BETWEEN TO_DATE('01/01/2020') AND TO_DATE('12/31/2022')\n",
    "AND (mf.SourceDrugName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(mf.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'\n",
    "                                  ))\n",
    "UNION\n",
    "\n",
    "SELECT ma.DataOwnerId AS DataOwnerId,\n",
    "p.MasterPatientId AS MasterPatientId, medadminstartdate as indexdate, p.patientid, p.BIRTHDATE\n",
    "FROM \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_MEDADMINS\" ma\n",
    "INNER JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_PATIENTS\" p ON ma.DataOwnerId = p.DataOwnerId AND ma.PatientId = p.PatientId\n",
    "LEFT JOIN \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" e ON ma.DataOwnerId = e.DataOwnerId AND ma.EncounterId = e.EncounterId\n",
    "WHERE (ma.SourceMedAdminMedName ILIKE ANY ('%Evusheld%', '%Tixagevimab%', '%Cilgavimab%', '%tixagev%', '%cilgav%')\n",
    "OR REPLACE(ma.NDC, '-') ILIKE ANY ('0310744202','0310889501','0310106101','0310886102'\n",
    "                                  , '00310744202','00310889501','00310106101','00310886102'))\n",
    " ) evu_exp\n",
    "   ) evu_age where row1 =1 and age is NOT NULL and dataownerid IN('137301f961d1fd77b33c529c9be609e52c35aca429583fc49b93ffb36487101a',\n",
    "                                    '1cbb8cafcbcfc22addedb1d9e2034afe0a29bb5b74f1f230dfd58e12322a3e11',\n",
    "                                    '5540c5b22e7435d6eb2a63e3a80b623d75eb34812013cb78575843f661f9bbc7',\n",
    "                                    '5fdd0ff9ae31f6c7ce6a195bd1a13b382143b8b6e70780fc18acf579dfc5e54b',\n",
    "                                    '6b952660a48d81f2da56f80a7a695446ea01ba3942c0ee6da3f38dafb5d60920',\n",
    "                                    '7804f6717b418811a9797e1805a921fb5b9582943c78e3924925d551c650a2a3',\n",
    "                                    '86d8165865fdd068bbb2b235990d6ea56c39fac4a5dc1cc53f65d6bc675e6363',\n",
    "                                    'a3bc2a45e2fb93d0ea261db098c16e6d8156fcbca543157de8deffbb156c8901',\n",
    "                                    'c48925c0b23c35d71a975a18c9478d371ad8c12b94b3e179bd1db880d48e56df',\n",
    "                                    'c877ef723bbc0de29171dcaa993fe3b86064bb0d0d7be4523bb0b71688ebbb72')) aa\n",
    "   where age >=12 \n",
    "   ) age_pat\n",
    "   \n",
    " INNER JOIN (select patientid, encounterdate\n",
    "             from \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_ENCOUNTERS\" \n",
    "                          ) en\n",
    "             on age_pat.patientid = en.patientid\n",
    "             where (encounterdate >= ((indexdate)-365) AND encounterdate < indexdate AND encounterdate is not null)\n",
    "             \n",
    "             ) inclusion_both\n",
    "             \n",
    "  INNER JOIN (select patientid, dxdate as com_date, SOURCEDXCODEDESCRIPTION\tas Name from \n",
    "              \"HRPCI\".\"GRATICULESOW3\".\"VW_DEID_DIAGNOSES\" \n",
    "             where dxcode IN ('B20','B97.35','O98.7','O98.71','O98.711','O98.712','O98.713','O98.719','O98.72','O98.73','Z21') ) Comorbidities\n",
    "             on inclusion_both.patientid = Comorbidities.patientid\n",
    "             where com_date < indexdate AND com_date >= '2020-01-01'\n",
    "  ) order by masterpatientid \"\"\")\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f7402a5b-59fe-4c8b-8e98-df04b17076ef",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "afb2d9f4-b78c-4a61-8e76-59467bdce883",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "case_age.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8c359569-1543-430f-8e58-2bf5f1ee7b5f",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "pip install psmpy"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e9db5621-41bc-47d6-b099-44b6751ffebd",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "from psmpy import PsmPy\n",
    "from psmpy.functions import cohenD\n",
    "from psmpy.plotting import *"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "18134021-32c8-470b-ad46-32782982d507",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "psm = PsmPy(case_age, treatment='treatment', indx='masterpatientid', exclude = ['CONDITION_NAME'])"
   ]
  }
 ],
 "metadata": {
  "availableInstances": [
   {
    "_defaultOrder": 0,
    "_isFastLaunch": true,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 4,
    "name": "ml.t3.medium",
    "vcpuNum": 2
   },
   {
    "_defaultOrder": 1,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 8,
    "name": "ml.t3.large",
    "vcpuNum": 2
   },
   {
    "_defaultOrder": 2,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 16,
    "name": "ml.t3.xlarge",
    "vcpuNum": 4
   },
   {
    "_defaultOrder": 3,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 32,
    "name": "ml.t3.2xlarge",
    "vcpuNum": 8
   },
   {
    "_defaultOrder": 4,
    "_isFastLaunch": true,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 8,
    "name": "ml.m5.large",
    "vcpuNum": 2
   },
   {
    "_defaultOrder": 5,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 16,
    "name": "ml.m5.xlarge",
    "vcpuNum": 4
   },
   {
    "_defaultOrder": 6,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 32,
    "name": "ml.m5.2xlarge",
    "vcpuNum": 8
   },
   {
    "_defaultOrder": 7,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 64,
    "name": "ml.m5.4xlarge",
    "vcpuNum": 16
   },
   {
    "_defaultOrder": 8,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 128,
    "name": "ml.m5.8xlarge",
    "vcpuNum": 32
   },
   {
    "_defaultOrder": 9,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 192,
    "name": "ml.m5.12xlarge",
    "vcpuNum": 48
   },
   {
    "_defaultOrder": 10,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 256,
    "name": "ml.m5.16xlarge",
    "vcpuNum": 64
   },
   {
    "_defaultOrder": 11,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 384,
    "name": "ml.m5.24xlarge",
    "vcpuNum": 96
   },
   {
    "_defaultOrder": 12,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 8,
    "name": "ml.m5d.large",
    "vcpuNum": 2
   },
   {
    "_defaultOrder": 13,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 16,
    "name": "ml.m5d.xlarge",
    "vcpuNum": 4
   },
   {
    "_defaultOrder": 14,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 32,
    "name": "ml.m5d.2xlarge",
    "vcpuNum": 8
   },
   {
    "_defaultOrder": 15,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 64,
    "name": "ml.m5d.4xlarge",
    "vcpuNum": 16
   },
   {
    "_defaultOrder": 16,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 128,
    "name": "ml.m5d.8xlarge",
    "vcpuNum": 32
   },
   {
    "_defaultOrder": 17,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 192,
    "name": "ml.m5d.12xlarge",
    "vcpuNum": 48
   },
   {
    "_defaultOrder": 18,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 256,
    "name": "ml.m5d.16xlarge",
    "vcpuNum": 64
   },
   {
    "_defaultOrder": 19,
    "_isFastLaunch": false,
    "category": "General purpose",
    "gpuNum": 0,
    "memoryGiB": 384,
    "name": "ml.m5d.24xlarge",
    "vcpuNum": 96
   },
   {
    "_defaultOrder": 20,
    "_isFastLaunch": true,
    "category": "Compute optimized",
    "gpuNum": 0,
    "memoryGiB": 4,
    "name": "ml.c5.large",
    "vcpuNum": 2
   },
   {
    "_defaultOrder": 21,
    "_isFastLaunch": false,
    "category": "Compute optimized",
    "gpuNum": 0,
    "memoryGiB": 8,
    "name": "ml.c5.xlarge",
    "vcpuNum": 4
   },
   {
    "_defaultOrder": 22,
    "_isFastLaunch": false,
    "category": "Compute optimized",
    "gpuNum": 0,
    "memoryGiB": 16,
    "name": "ml.c5.2xlarge",
    "vcpuNum": 8
   },
   {
    "_defaultOrder": 23,
    "_isFastLaunch": false,
    "category": "Compute optimized",
    "gpuNum": 0,
    "memoryGiB": 32,
    "name": "ml.c5.4xlarge",
    "vcpuNum": 16
   },
   {
    "_defaultOrder": 24,
    "_isFastLaunch": false,
    "category": "Compute optimized",
    "gpuNum": 0,
    "memoryGiB": 72,
    "name": "ml.c5.9xlarge",
    "vcpuNum": 36
   },
   {
    "_defaultOrder": 25,
    "_isFastLaunch": false,
    "category": "Compute optimized",
    "gpuNum": 0,
    "memoryGiB": 96,
    "name": "ml.c5.12xlarge",
    "vcpuNum": 48
   },
   {
    "_defaultOrder": 26,
    "_isFastLaunch": false,
    "category": "Compute optimized",
    "gpuNum": 0,
    "memoryGiB": 144,
    "name": "ml.c5.18xlarge",
    "vcpuNum": 72
   },
   {
    "_defaultOrder": 27,
    "_isFastLaunch": false,
    "category": "Compute optimized",
    "gpuNum": 0,
    "memoryGiB": 192,
    "name": "ml.c5.24xlarge",
    "vcpuNum": 96
   },
   {
    "_defaultOrder": 28,
    "_isFastLaunch": true,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 16,
    "name": "ml.g4dn.xlarge",
    "vcpuNum": 4
   },
   {
    "_defaultOrder": 29,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 32,
    "name": "ml.g4dn.2xlarge",
    "vcpuNum": 8
   },
   {
    "_defaultOrder": 30,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 64,
    "name": "ml.g4dn.4xlarge",
    "vcpuNum": 16
   },
   {
    "_defaultOrder": 31,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 128,
    "name": "ml.g4dn.8xlarge",
    "vcpuNum": 32
   },
   {
    "_defaultOrder": 32,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 4,
    "memoryGiB": 192,
    "name": "ml.g4dn.12xlarge",
    "vcpuNum": 48
   },
   {
    "_defaultOrder": 33,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 256,
    "name": "ml.g4dn.16xlarge",
    "vcpuNum": 64
   },
   {
    "_defaultOrder": 34,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 61,
    "name": "ml.p3.2xlarge",
    "vcpuNum": 8
   },
   {
    "_defaultOrder": 35,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 4,
    "memoryGiB": 244,
    "name": "ml.p3.8xlarge",
    "vcpuNum": 32
   },
   {
    "_defaultOrder": 36,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 8,
    "memoryGiB": 488,
    "name": "ml.p3.16xlarge",
    "vcpuNum": 64
   },
   {
    "_defaultOrder": 37,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 8,
    "memoryGiB": 768,
    "name": "ml.p3dn.24xlarge",
    "vcpuNum": 96
   },
   {
    "_defaultOrder": 38,
    "_isFastLaunch": false,
    "category": "Memory Optimized",
    "gpuNum": 0,
    "memoryGiB": 16,
    "name": "ml.r5.large",
    "vcpuNum": 2
   },
   {
    "_defaultOrder": 39,
    "_isFastLaunch": false,
    "category": "Memory Optimized",
    "gpuNum": 0,
    "memoryGiB": 32,
    "name": "ml.r5.xlarge",
    "vcpuNum": 4
   },
   {
    "_defaultOrder": 40,
    "_isFastLaunch": false,
    "category": "Memory Optimized",
    "gpuNum": 0,
    "memoryGiB": 64,
    "name": "ml.r5.2xlarge",
    "vcpuNum": 8
   },
   {
    "_defaultOrder": 41,
    "_isFastLaunch": false,
    "category": "Memory Optimized",
    "gpuNum": 0,
    "memoryGiB": 128,
    "name": "ml.r5.4xlarge",
    "vcpuNum": 16
   },
   {
    "_defaultOrder": 42,
    "_isFastLaunch": false,
    "category": "Memory Optimized",
    "gpuNum": 0,
    "memoryGiB": 256,
    "name": "ml.r5.8xlarge",
    "vcpuNum": 32
   },
   {
    "_defaultOrder": 43,
    "_isFastLaunch": false,
    "category": "Memory Optimized",
    "gpuNum": 0,
    "memoryGiB": 384,
    "name": "ml.r5.12xlarge",
    "vcpuNum": 48
   },
   {
    "_defaultOrder": 44,
    "_isFastLaunch": false,
    "category": "Memory Optimized",
    "gpuNum": 0,
    "memoryGiB": 512,
    "name": "ml.r5.16xlarge",
    "vcpuNum": 64
   },
   {
    "_defaultOrder": 45,
    "_isFastLaunch": false,
    "category": "Memory Optimized",
    "gpuNum": 0,
    "memoryGiB": 768,
    "name": "ml.r5.24xlarge",
    "vcpuNum": 96
   },
   {
    "_defaultOrder": 46,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 16,
    "name": "ml.g5.xlarge",
    "vcpuNum": 4
   },
   {
    "_defaultOrder": 47,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 32,
    "name": "ml.g5.2xlarge",
    "vcpuNum": 8
   },
   {
    "_defaultOrder": 48,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 64,
    "name": "ml.g5.4xlarge",
    "vcpuNum": 16
   },
   {
    "_defaultOrder": 49,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 128,
    "name": "ml.g5.8xlarge",
    "vcpuNum": 32
   },
   {
    "_defaultOrder": 50,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 1,
    "memoryGiB": 256,
    "name": "ml.g5.16xlarge",
    "vcpuNum": 64
   },
   {
    "_defaultOrder": 51,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 4,
    "memoryGiB": 192,
    "name": "ml.g5.12xlarge",
    "vcpuNum": 48
   },
   {
    "_defaultOrder": 52,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 4,
    "memoryGiB": 384,
    "name": "ml.g5.24xlarge",
    "vcpuNum": 96
   },
   {
    "_defaultOrder": 53,
    "_isFastLaunch": false,
    "category": "Accelerated computing",
    "gpuNum": 8,
    "memoryGiB": 768,
    "name": "ml.g5.48xlarge",
    "vcpuNum": 192
   }
  ],
  "instance_type": "ml.t3.medium",
  "kernelspec": {
   "display_name": "Python 3 (Data Science 2.0)",
   "language": "python",
   "name": "python3__SAGEMAKER_INTERNAL__arn:aws:sagemaker:us-east-1:081325390199:image/sagemaker-data-science-38"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.13"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
